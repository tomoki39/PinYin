<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>PinYin</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" sizes="32x32" href="/icons/pinyin_icon_32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/icons/pinyin_icon_16x16.png">
    <link rel="apple-touch-icon" href="/icons/pinyin_icon_192x192.png">
    
    <!-- iOS Web App Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="ÊãºÈü≥">
    
    <!-- iOS Icons -->
    <link rel="apple-touch-icon" href="/icons/pinyin_icon_192x192.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/icons/pinyin_icon_144x144.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/icons/pinyin_icon_192x192.png">
    <link rel="apple-touch-icon" sizes="167x167" href="/icons/pinyin_icon_144x144.png">
    
    <!-- Web App Manifest -->
    <link rel="manifest" href="/manifest.json">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #ffffff;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            /* iOS-specific styles */
            padding-top: env(safe-area-inset-top);
            padding-bottom: env(safe-area-inset-bottom);
        }
        
        .container {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 500px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .app-title {
            font-size: 2.5em;
            font-weight: 700;
            color: #DC143C;
            margin-bottom: 10px;
        }
        
        .subtitle {
            color: #666;
            font-size: 1.1em;
        }
        
        .input-section {
            margin-bottom: 25px;
        }
        
        .input-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }
        
        input, textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid #e1e5e9;
            border-radius: 12px;
            font-size: 16px;
            transition: border-color 0.3s ease;
            font-family: inherit;
        }
        
        input:focus, textarea:focus {
            outline: none;
            border-color: #DC143C;
        }
        
        input::placeholder, textarea::placeholder {
            color: #999;
            opacity: 1;
        }
        
        textarea {
            resize: vertical;
            min-height: 120px;
        }
        
        .button-group {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
        }
        
        button {
            flex: 1;
            padding: 15px 20px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: inherit;
        }
        
        .convert-btn {
            background: linear-gradient(45deg, #DC143C, #B22222);
            color: white;
        }
        
        .convert-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(220, 20, 60, 0.3);
        }
        
        .clear-btn {
            background: #f5f5f5;
            color: #666;
        }
        
        .clear-btn:hover {
            background: #e0e0e0;
        }
        
        .result-section {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            min-height: 100px;
        }
        
        .result-text {
            font-size: 18px;
            line-height: 1.6;
            color: #333;
            word-wrap: break-word;
        }
        
        .loading {
            text-align: center;
            color: #666;
            font-style: italic;
        }
        
        .instructions {
            margin-top: 20px;
            padding: 15px;
            background: #fff5f5;
            border-radius: 10px;
            border-left: 4px solid #DC143C;
        }
        
        .instructions h3 {
            color: #DC143C;
            margin-bottom: 10px;
        }
        
        .instructions p {
            color: #555;
            font-size: 14px;
            line-height: 1.5;
        }
        
        .install-instructions {
            margin-top: 15px;
            padding: 10px;
            background: #fff3cd;
            border-radius: 8px;
            border-left: 4px solid #ffc107;
        }
        
        .install-instructions h4 {
            color: #856404;
            margin-bottom: 8px;
            font-size: 14px;
        }
        
        .install-instructions ol {
            color: #856404;
            font-size: 12px;
        }
        
        /* Responsive design for tone options */
        @media (max-width: 600px) {
            .tone-options {
                flex-direction: column !important;
                gap: 8px !important;
            }
            
            .tone-options label {
                min-width: 0 !important;
                flex: none !important;
            }
        }
        
        /* Custom radio button styling */
        input[type="radio"] {
            margin: 0;
            padding: 0;
            width: 16px;
            height: 16px;
            cursor: pointer;
        }
        
        .install-instructions ol {
            padding-left: 20px;
        }
        
        .install-instructions li {
            margin-bottom: 4px;
        }
        
        /* Dark mode support */
        @media (prefers-color-scheme: dark) {
            body {
                background: #1a1a1a;
            }
            
            .container {
                background: #2c3e50;
                color: white;
            }
            
            .app-title {
                color: #DC143C;
            }
            
            .subtitle {
                color: #bdc3c7;
            }
            
            label {
                color: #ecf0f1;
            }
            
            input, textarea {
                background: #34495e;
                border-color: #7f8c8d;
                color: white;
            }
            
            input:focus, textarea:focus {
                border-color: #DC143C;
            }
            
            .result-section {
                background: #34495e;
            }
            
            .result-text {
                color: #ecf0f1;
            }
            
            .instructions {
                background: #2c3e50;
                border-left-color: #DC143C;
            }
            
            .instructions h3 {
                color: #DC143C;
            }
            
            .instructions p {
                color: #bdc3c7;
            }
            
            .install-instructions {
                background: #34495e;
                border-left-color: #f39c12;
            }
            
            .install-instructions h4 {
                color: #f39c12;
            }
            
            .install-instructions ol {
                color: #f39c12;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 class="app-title" data-en="PinYin" data-ja="„Éî„É≥„Ç§„É≥" data-zh="ÊãºÈü≥" data-ko="Î≥ëÏùå" data-es="PinYin" data-fr="PinYin" data-de="PinYin" data-it="PinYin" data-pt="PinYin" data-ru="–ü–∏–Ω—å–∏–Ω—å" data-ar="ÿ®ŸäŸÜŸäŸäŸÜ" data-hi="‡§™‡§ø‡§®‡§Ø‡§ø‡§®" data-tr="PinYin" data-vi="PinYin" data-th="‡∏û‡∏¥‡∏ô‡∏≠‡∏¥‡∏ô" data-pl="PinYin" data-nl="PinYin" data-sv="PinYin" data-da="PinYin" data-fi="PinYin">PinYin</h1>
            <p class="subtitle" data-en="Chinese to Pinyin Converter" data-ja="‰∏≠ÂõΩË™û„Åã„Çâ„Éî„É≥„Ç§„É≥„Å∏„ÅÆÂ§âÊèõ" data-zh="‰∏≠ÊñáËΩ¨ÊãºÈü≥Â∑•ÂÖ∑" data-ko="Ï§ëÍµ≠Ïñ¥ Î≥ëÏùå Î≥ÄÌôòÍ∏∞" data-es="Convertidor de Chino a Pinyin" data-fr="Convertisseur Chinois vers Pinyin" data-de="Chinesisch zu Pinyin Konverter" data-it="Convertitore Cinese-Pinyin" data-pt="Conversor Chin√™s-Pinyin" data-ru="–ö–æ–Ω–≤–µ—Ä—Ç–µ—Ä –∫–∏—Ç–∞–π—Å–∫–æ–≥–æ –≤ –ø–∏–Ω—å–∏–Ω—å" data-ar="ŸÖÿ≠ŸàŸÑ ÿßŸÑÿµŸäŸÜŸäÿ© ÿ•ŸÑŸâ ÿ®ŸäŸÜŸäŸäŸÜ" data-hi="‡§ö‡•Ä‡§®‡•Ä ‡§∏‡•á ‡§™‡§ø‡§®‡§Ø‡§ø‡§® ‡§ï‡§®‡§µ‡§∞‡•ç‡§ü‡§∞" data-tr="√áince-Pinyin D√∂n√º≈üt√ºr√ºc√º" data-vi="B·ªô chuy·ªÉn ƒë·ªïi ti·∫øng Trung sang Pinyin" data-th="‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏•‡∏á‡∏†‡∏≤‡∏©‡∏≤‡∏à‡∏µ‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏û‡∏¥‡∏ô‡∏≠‡∏¥‡∏ô" data-pl="Konwerter chi≈Ñskiego na Pinyin" data-nl="Chinees naar Pinyin converter" data-sv="Kinesisk till Pinyin konverterare" data-da="Kinesisk til Pinyin konverter" data-fi="Kiinan-Pinyin muunnin">Chinese to Pinyin Converter</p>
        </div>
        
        <div class="input-section">
            <div class="input-group">
                <label for="chineseInput" data-en="Chinese Text:" data-ja="‰∏≠ÂõΩË™û„ÉÜ„Ç≠„Çπ„Éà:" data-zh="‰∏≠ÊñáÊñáÊú¨:" data-ko="Ï§ëÍµ≠Ïñ¥ ÌÖçÏä§Ìä∏:" data-es="Texto Chino:" data-fr="Texte Chinois:" data-de="Chinesischer Text:" data-it="Testo Cinese:" data-pt="Texto Chin√™s:" data-ru="–ö–∏—Ç–∞–π—Å–∫–∏–π —Ç–µ–∫—Å—Ç:" data-ar="ÿßŸÑŸÜÿµ ÿßŸÑÿµŸäŸÜŸä:" data-hi="‡§ö‡•Ä‡§®‡•Ä ‡§™‡§æ‡§†:" data-tr="√áince Metin:" data-vi="VƒÉn b·∫£n ti·∫øng Trung:" data-th="‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏µ‡∏ô:" data-pl="Tekst chi≈Ñski:" data-nl="Chinese tekst:" data-sv="Kinesisk text:" data-da="Kinesisk tekst:" data-fi="Kiinan teksti:">Chinese Text:</label>
                <textarea id="chineseInput" data-en="Enter Chinese characters here..." data-ja="„Åì„Åì„Å´‰∏≠ÂõΩË™ûÊñáÂ≠ó„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ..." data-zh="Âú®Ê≠§ËæìÂÖ•‰∏≠ÊñáÂ≠óÁ¨¶..." data-ko="Ïó¨Í∏∞Ïóê Ï§ëÍµ≠Ïñ¥ Î¨∏ÏûêÎ•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî..." data-es="Ingrese caracteres chinos aqu√≠..." data-fr="Entrez des caract√®res chinois ici..." data-de="Geben Sie hier chinesische Zeichen ein..." data-it="Inserisci caratteri cinesi qui..." data-pt="Digite caracteres chineses aqui..." data-ru="–í–≤–µ–¥–∏—Ç–µ –∫–∏—Ç–∞–π—Å–∫–∏–µ —Å–∏–º–≤–æ–ª—ã –∑–¥–µ—Å—å..." data-ar="ÿ£ÿØÿÆŸÑ ÿßŸÑÿ£ÿ≠ÿ±ŸÅ ÿßŸÑÿµŸäŸÜŸäÿ© ŸáŸÜÿß..." data-hi="‡§Ø‡§π‡§æ‡§Ç ‡§ö‡•Ä‡§®‡•Ä ‡§Ö‡§ï‡•ç‡§∑‡§∞ ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç..." data-tr="Buraya √áince karakterler girin..." data-vi="Nh·∫≠p k√Ω t·ª± ti·∫øng Trung t·∫°i ƒë√¢y..." data-th="‡∏õ‡πâ‡∏≠‡∏ô‡∏≠‡∏±‡∏Å‡∏Ç‡∏£‡∏∞‡∏à‡∏µ‡∏ô‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà..." data-pl="Wprowad≈∫ znaki chi≈Ñskie tutaj..." data-nl="Voer hier Chinese karakters in..." data-sv="Ange kinesiska tecken h√§r..." data-da="Indtast kinesiske tegn her..." data-fi="Sy√∂t√§ kiinalaisia merkkej√§ t√§h√§n..." placeholder="Enter Chinese characters here..."></textarea>
            </div>
            <!-- Â£∞Ë™øË°®Ë®òÂàá„ÇäÊõø„Åà„É©„Ç∏„Ç™„Éú„Çø„É≥ËøΩÂä† -->
            <div class="input-group" style="margin-bottom: 10px;">
                <label data-en="Tone format:" data-ja="Â£∞Ë™øÂΩ¢ÂºèÔºö" data-zh="Â£∞Ë∞ÉÊ†ºÂºèÔºö" data-ko="ÏÑ±Ï°∞ ÌòïÏãù:" data-es="Formato de tono:" data-fr="Format de ton:" data-de="Tonformat:" data-it="Formato tonale:" data-pt="Formato de tom:" data-ru="–§–æ—Ä–º–∞—Ç —Ç–æ–Ω–∞:" data-ar="ÿ™ŸÜÿ≥ŸäŸÇ ÿßŸÑŸÜÿ∫ŸÖÿ©:" data-hi="‡§∏‡•ç‡§µ‡§∞ ‡§™‡•ç‡§∞‡§æ‡§∞‡•Ç‡§™:" data-tr="Ton formatƒ±:" data-vi="ƒê·ªãnh d·∫°ng thanh ƒëi·ªáu:" data-th="‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÄ‡∏™‡∏µ‡∏¢‡∏á:" data-pl="Format tonu:" data-nl="Toonformaat:" data-sv="Tonformat:" data-da="Toneformat:" data-fi="S√§velmuoto:">Tone format:</label>
                <div class="tone-options" style="display: flex; gap: 16px; margin-top: 4px; flex-wrap: wrap; justify-content: flex-start;">
                    <label style="display: flex; align-items: center; gap: 2px; min-width: 0; flex: 0 1 auto; margin: 0; padding: 0;"><input type="radio" name="toneType" value="sign" checked> <span data-en="Tonal signs (ƒÅ, √°, «é, √†)" data-ja="Â£∞Ë™øÁ¨¶Âè∑ (ƒÅ, √°, «é, √†)" data-zh="Â£∞Ë∞ÉÁ¨¶Âè∑ (ƒÅ, √°, «é, √†)" data-ko="ÏÑ±Ï°∞ Í∏∞Ìò∏ (ƒÅ, √°, «é, √†)" data-es="Signos tonales (ƒÅ, √°, «é, √†)" data-fr="Signes tonaux (ƒÅ, √°, «é, √†)" data-de="Tonzeichen (ƒÅ, √°, «é, √†)" data-it="Segni tonali (ƒÅ, √°, «é, √†)" data-pt="Sinais tonais (ƒÅ, √°, «é, √†)" data-ru="–¢–æ–Ω–∞–ª—å–Ω—ã–µ –∑–Ω–∞–∫–∏ (ƒÅ, √°, «é, √†)" data-ar="ÿπŸÑÿßŸÖÿßÿ™ ÿßŸÑŸÜÿ∫ŸÖÿ© (ƒÅ, √°, «é, √†)" data-hi="‡§∏‡•ç‡§µ‡§∞ ‡§ö‡§ø‡§π‡•ç‡§® (ƒÅ, √°, «é, √†)" data-tr="Ton i≈üaretleri (ƒÅ, √°, «é, √†)" data-vi="D·∫•u thanh ƒëi·ªáu (ƒÅ, √°, «é, √†)" data-th="‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏™‡∏µ‡∏¢‡∏á (ƒÅ, √°, «é, √†)" data-pl="Znaki tonalne (ƒÅ, √°, «é, √†)" data-nl="Toontekens (ƒÅ, √°, «é, √†)" data-sv="Tonala tecken (ƒÅ, √°, «é, √†)" data-da="Tonale tegn (ƒÅ, √°, «é, √†)" data-fi="S√§velmerkit (ƒÅ, √°, «é, √†)">Tonal signs (ƒÅ, √°, «é, √†)</span></label>
                    <label style="display: flex; align-items: center; gap: 2px; min-width: 0; flex: 0 1 auto; margin: 0; padding: 0;"><input type="radio" name="toneType" value="number"> <span data-en="Tonal numbers (a1, a2, a3, a4)" data-ja="Â£∞Ë™øÊï∞Â≠ó (a1, a2, a3, a4)" data-zh="Â£∞Ë∞ÉÊï∞Â≠ó (a1, a2, a3, a4)" data-ko="ÏÑ±Ï°∞ Ïà´Ïûê (a1, a2, a3, a4)" data-es="N√∫meros tonales (a1, a2, a3, a4)" data-fr="Nombres tonaux (a1, a2, a3, a4)" data-de="Tonzahlen (a1, a2, a3, a4)" data-it="Numeri tonali (a1, a2, a3, a4)" data-pt="N√∫meros tonais (a1, a2, a3, a4)" data-ru="–¢–æ–Ω–∞–ª—å–Ω—ã–µ —á–∏—Å–ª–∞ (a1, a2, a3, a4)" data-ar="ÿ£ÿ±ŸÇÿßŸÖ ÿßŸÑŸÜÿ∫ŸÖÿ© (a1, a2, a3, a4)" data-hi="‡§∏‡•ç‡§µ‡§∞ ‡§∏‡§Ç‡§ñ‡•ç‡§Ø‡§æ‡§è‡§Ç (a1, a2, a3, a4)" data-tr="Ton numaralarƒ± (a1, a2, a3, a4)" data-vi="S·ªë thanh ƒëi·ªáu (a1, a2, a3, a4)" data-th="‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡πÄ‡∏™‡∏µ‡∏¢‡∏á (a1, a2, a3, a4)" data-pl="Liczby tonalne (a1, a2, a3, a4)" data-nl="Toonnummers (a1, a2, a3, a4)" data-sv="Tonala siffror (a1, a2, a3, a4)" data-da="Tonale tal (a1, a2, a3, a4)" data-fi="S√§velnumerot (a1, a2, a3, a4)">Tonal numbers (a1, a2, a3, a4)</span></label>
                </div>
            </div>
            
            <div class="button-group">
                <button class="convert-btn" onclick="convertToPinyin()" data-en="Convert to Pinyin" data-ja="„Éî„É≥„Ç§„É≥„Å´Â§âÊèõ" data-zh="ËΩ¨Êç¢‰∏∫ÊãºÈü≥" data-ko="Î≥ëÏùåÏúºÎ°ú Î≥ÄÌôò" data-es="Convertir a Pinyin" data-fr="Convertir en Pinyin" data-de="Zu Pinyin konvertieren" data-it="Converti in Pinyin" data-pt="Converter para Pinyin" data-ru="–ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ –ø–∏–Ω—å–∏–Ω—å" data-ar="ÿ™ÿ≠ŸàŸäŸÑ ÿ•ŸÑŸâ ÿ®ŸäŸÜŸäŸäŸÜ" data-hi="‡§™‡§ø‡§®‡§Ø‡§ø‡§® ‡§Æ‡•á‡§Ç ‡§¨‡§¶‡§≤‡•á‡§Ç" data-tr="Pinyin'e D√∂n√º≈üt√ºr" data-vi="Chuy·ªÉn ƒë·ªïi sang Pinyin" data-th="‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏û‡∏¥‡∏ô‡∏≠‡∏¥‡∏ô" data-pl="Konwertuj na Pinyin" data-nl="Converteren naar Pinyin" data-sv="Konvertera till Pinyin" data-da="Konverter til Pinyin" data-fi="Muunna Pinyiniksi">Convert to Pinyin</button>
                <button class="clear-btn" onclick="clearAll()" data-en="Clear" data-ja="„ÇØ„É™„Ç¢" data-zh="Ê∏ÖÈô§" data-ko="ÏßÄÏö∞Í∏∞" data-es="Limpiar" data-fr="Effacer" data-de="L√∂schen" data-it="Cancella" data-pt="Limpar" data-ru="–û—á–∏—Å—Ç–∏—Ç—å" data-ar="ŸÖÿ≥ÿ≠" data-hi="‡§∏‡§æ‡§´‡§º ‡§ï‡§∞‡•á‡§Ç" data-tr="Temizle" data-vi="X√≥a" data-th="‡∏•‡πâ‡∏≤‡∏á" data-pl="Wyczy≈õƒá" data-nl="Wissen" data-sv="Rensa" data-da="Ryd" data-fi="Tyhjenn√§">Clear</button>
            </div>
        </div>
        
        <div class="result-section">
            <div id="result" class="result-text" data-en="Pinyin will appear here..." data-ja="„Éî„É≥„Ç§„É≥„Åå„Åì„Åì„Å´Ë°®Á§∫„Åï„Çå„Åæ„Åô..." data-zh="ÊãºÈü≥Â∞ÜÂú®Ê≠§ÊòæÁ§∫..." data-ko="Î≥ëÏùåÏù¥ Ïó¨Í∏∞Ïóê ÎÇòÌÉÄÎÇ† Í≤ÉÏûÖÎãàÎã§..." data-es="El Pinyin aparecer√° aqu√≠..." data-fr="Le Pinyin appara√Ætra ici..." data-de="Pinyin wird hier erscheinen..." data-it="Il Pinyin apparir√† qui..." data-pt="O Pinyin aparecer√° aqui..." data-ru="–ü–∏–Ω—å–∏–Ω—å –ø–æ—è–≤–∏—Ç—Å—è –∑–¥–µ—Å—å..." data-ar="ÿ≥Ÿäÿ∏Ÿáÿ± ÿßŸÑÿ®ŸäŸÜŸäŸäŸÜ ŸáŸÜÿß..." data-hi="‡§™‡§ø‡§®‡§Ø‡§ø‡§® ‡§Ø‡§π‡§æ‡§Ç ‡§¶‡§ø‡§ñ‡§æ‡§à ‡§¶‡•á‡§ó‡§æ..." data-tr="Pinyin burada g√∂r√ºnecek..." data-vi="Pinyin s·∫Ω xu·∫•t hi·ªán ·ªü ƒë√¢y..." data-th="‡∏û‡∏¥‡∏ô‡∏≠‡∏¥‡∏ô‡∏à‡∏∞‡∏õ‡∏£‡∏≤‡∏Å‡∏è‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà..." data-pl="Pinyin pojawi siƒô tutaj..." data-nl="Pinyin verschijnt hier..." data-sv="Pinyin kommer att visas h√§r..." data-da="Pinyin vil vises her..." data-fi="Pinyin n√§kyy t√§√§ll√§...">Pinyin will appear here...</div>
            <div id="details" style="display: none; margin-top: 10px; padding: 10px; background-color: #f8f9fa; border-left: 3px solid #007bff; font-size: 0.9em; color: #666;"></div>
        </div>
        
        <div class="instructions">
            <h3 data-en="üì± PinYin App" data-ja="üì± „Éî„É≥„Ç§„É≥„Ç¢„Éó„É™" data-zh="üì± ÊãºÈü≥Â∫îÁî®" data-ko="üì± Î≥ëÏùå Ïï±" data-es="üì± Aplicaci√≥n PinYin" data-fr="üì± Application PinYin" data-de="üì± PinYin App" data-it="üì± App PinYin" data-pt="üì± Aplicativo PinYin" data-ru="üì± –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ü–∏–Ω—å–∏–Ω—å" data-ar="üì± ÿ™ÿ∑ÿ®ŸäŸÇ ÿ®ŸäŸÜŸäŸäŸÜ" data-hi="üì± ‡§™‡§ø‡§®‡§Ø‡§ø‡§® ‡§ê‡§™" data-tr="üì± PinYin Uygulamasƒ±" data-vi="üì± ·ª®ng d·ª•ng PinYin" data-th="üì± ‡πÅ‡∏≠‡∏õ‡∏û‡∏¥‡∏ô‡∏≠‡∏¥‡∏ô" data-pl="üì± Aplikacja PinYin" data-nl="üì± PinYin App" data-sv="üì± PinYin App" data-da="üì± PinYin App" data-fi="üì± PinYin-sovellus">üì± PinYin App</h3>
            <p data-en="This is a Progressive Web App that works like a native app!" data-ja="„Åì„Çå„ÅØ„Éç„Ç§„ÉÜ„Ç£„Éñ„Ç¢„Éó„É™„ÅÆ„Çà„ÅÜ„Å´Âãï‰Ωú„Åô„Çã„Éó„É≠„Ç∞„É¨„ÉÉ„Ç∑„Éñ„Ç¶„Çß„Éñ„Ç¢„Éó„É™„Åß„ÅôÔºÅ" data-zh="ËøôÊòØ‰∏Ä‰∏™ÂÉèÂéüÁîüÂ∫îÁî®‰∏ÄÊ†∑Â∑•‰ΩúÁöÑÊ∏êËøõÂºèÁΩëÁªúÂ∫îÁî®ÔºÅ" data-ko="ÎÑ§Ïù¥Ìã∞Î∏å Ïï±Ï≤òÎüº ÏûëÎèôÌïòÎäî ÌîÑÎ°úÍ∑∏Î†àÏãúÎ∏å Ïõπ Ïï±ÏûÖÎãàÎã§!" data-es="¬°Esta es una aplicaci√≥n web progresiva que funciona como una aplicaci√≥n nativa!" data-fr="C'est une application web progressive qui fonctionne comme une application native !" data-de="Dies ist eine Progressive Web App, die wie eine native App funktioniert!" data-it="Questa √® un'app web progressiva che funziona come un'app nativa!" data-pt="Esta √© um aplicativo web progressivo que funciona como um aplicativo nativo!" data-ru="–≠—Ç–æ –ø—Ä–æ–≥—Ä–µ—Å—Å–∏–≤–Ω–æ–µ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ –Ω–∞—Ç–∏–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ!" data-ar="Ÿáÿ∞ÿß ÿ™ÿ∑ÿ®ŸäŸÇ ŸàŸäÿ® ÿ™ÿØÿ±Ÿäÿ¨Ÿä ŸäÿπŸÖŸÑ ŸÖÿ´ŸÑ ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ ÿßŸÑÿ£ÿµŸÑŸä!" data-hi="‡§Ø‡§π ‡§è‡§ï ‡§™‡•ç‡§∞‡•ã‡§ó‡•ç‡§∞‡•á‡§∏‡§ø‡§µ ‡§µ‡•á‡§¨ ‡§ê‡§™ ‡§π‡•à ‡§ú‡•ã ‡§®‡•á‡§ü‡§ø‡§µ ‡§ê‡§™ ‡§ï‡•Ä ‡§§‡§∞‡§π ‡§ï‡§æ‡§Æ ‡§ï‡§∞‡§§‡§æ ‡§π‡•à!" data-tr="Bu, yerel uygulama gibi √ßalƒ±≈üan bir ilerleyici web uygulamasƒ±dƒ±r!" data-vi="ƒê√¢y l√† ·ª©ng d·ª•ng web ti·∫øn b·ªô ho·∫°t ƒë·ªông nh∆∞ ·ª©ng d·ª•ng g·ªëc!" data-th="‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠‡πÅ‡∏≠‡∏õ‡∏û‡∏•‡∏¥‡πÄ‡∏Ñ‡∏ä‡∏±‡∏ô‡πÄ‡∏ß‡πá‡∏ö‡πÅ‡∏ö‡∏ö‡∏Å‡πâ‡∏≤‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÅ‡∏≠‡∏õ‡πÄ‡∏ô‡∏ó‡∏µ‡∏ü!" data-pl="To jest progresywna aplikacja internetowa, kt√≥ra dzia≈Ça jak natywna aplikacja!" data-nl="Dit is een progressieve web-app die werkt als een native app!" data-sv="Detta √§r en progressiv webbapp som fungerar som en inbyggd app!" data-da="Dette er en progressiv web-app der fungerer som en native app!" data-fi="T√§m√§ on progressiivinen verkkosovellus, joka toimii kuin natiivisovellus!">This is a Progressive Web App that works like a native app!</p>
        </div>
        
        <div class="install-instructions">
            <h4 data-en="üì≤ Install as Native App:" data-ja="üì≤ „Éç„Ç§„ÉÜ„Ç£„Éñ„Ç¢„Éó„É™„Å®„Åó„Å¶„Ç§„É≥„Çπ„Éà„Éº„É´:" data-zh="üì≤ ‰Ωú‰∏∫ÂéüÁîüÂ∫îÁî®ÂÆâË£Ö:" data-ko="üì≤ ÎÑ§Ïù¥Ìã∞Î∏å Ïï±ÏúºÎ°ú ÏÑ§Ïπò:" data-es="üì≤ Instalar como aplicaci√≥n nativa:" data-fr="üì≤ Installer como application native:" data-de="üì≤ Als native App installieren:" data-it="üì≤ Installa come app nativa:" data-pt="üì≤ Instalar como aplicativo nativo:" data-ru="üì≤ –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–∞–∫ –Ω–∞—Ç–∏–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:" data-ar="üì≤ ÿ™ÿ´ÿ®Ÿäÿ™ ŸÉÿ™ÿ∑ÿ®ŸäŸÇ ÿ£ÿµŸÑŸä:" data-hi="üì≤ ‡§®‡•á‡§ü‡§ø‡§µ ‡§ê‡§™ ‡§ï‡•á ‡§∞‡•Ç‡§™ ‡§Æ‡•á‡§Ç ‡§á‡§Ç‡§∏‡•ç‡§ü‡•â‡§≤ ‡§ï‡§∞‡•á‡§Ç:" data-tr="üì≤ Yerel Uygulama Olarak Y√ºkle:" data-vi="üì≤ C√†i ƒë·∫∑t nh∆∞ ·ª©ng d·ª•ng g·ªëc:" data-th="üì≤ ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏≠‡∏õ‡πÄ‡∏ô‡∏ó‡∏µ‡∏ü:" data-pl="üì≤ Zainstaluj jako aplikacjƒô natywnƒÖ:" data-nl="üì≤ Installeren als native app:" data-sv="üì≤ Installera som inbyggd app:" data-da="üì≤ Installer som native app:" data-fi="üì≤ Asenna natiivisovelluksena:">üì≤ Install as Native App:</h4>
            <ol>
                <li data-en="Tap the Share button (üì§) in your browser" data-ja="„Éñ„É©„Ç¶„Ç∂„ÅßÂÖ±Êúâ„Éú„Çø„É≥Ôºàüì§Ôºâ„Çí„Çø„ÉÉ„Éó" data-zh="Âú®ÊµèËßàÂô®‰∏≠ÁÇπÂáªÂàÜ‰∫´ÊåâÈíÆÔºàüì§Ôºâ" data-ko="Î∏åÎùºÏö∞Ï†ÄÏóêÏÑú Í≥µÏú† Î≤ÑÌäº(üì§)ÏùÑ ÌÉ≠ÌïòÏÑ∏Ïöî" data-es="Toca el bot√≥n Compartir (üì§) en tu navegador" data-fr="Appuyez sur le bouton Partager (üì§) dans votre navigateur" data-de="Tippen Sie auf die Teilen-Schaltfl√§che (üì§) in Ihrem Browser" data-it="Tocca il pulsante Condividi (üì§) nel tuo browser" data-pt="Toque no bot√£o Compartilhar (üì§) no seu navegador" data-ru="–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –ü–æ–¥–µ–ª–∏—Ç—å—Å—è (üì§) –≤ –≤–∞—à–µ–º –±—Ä–∞—É–∑–µ—Ä–µ" data-ar="ÿßŸÜŸÇÿ± ÿπŸÑŸâ ÿ≤ÿ± ÿßŸÑŸÖÿ¥ÿßÿ±ŸÉÿ© (üì§) ŸÅŸä ŸÖÿ™ÿµŸÅÿ≠ŸÉ" data-hi="‡§Ö‡§™‡§®‡•á ‡§¨‡•ç‡§∞‡§æ‡§â‡§ú‡§º‡§∞ ‡§Æ‡•á‡§Ç ‡§∂‡•á‡§Ø‡§∞ ‡§¨‡§ü‡§® (üì§) ‡§ü‡•à‡§™ ‡§ï‡§∞‡•á‡§Ç" data-tr="Tarayƒ±cƒ±nƒ±zda Payla≈ü d√ºƒümesine (üì§) dokunun" data-vi="Nh·∫•n n√∫t Chia s·∫ª (üì§) trong tr√¨nh duy·ªát c·ªßa b·∫°n" data-th="‡πÅ‡∏ï‡∏∞‡∏õ‡∏∏‡πà‡∏°‡πÅ‡∏ä‡∏£‡πå (üì§) ‡πÉ‡∏ô‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì" data-pl="Dotknij przycisku Udostƒôpnij (üì§) w swojej przeglƒÖdarce" data-nl="Tik op de Deel-knop (üì§) in je browser" data-sv="Tryck p√• Dela-knappen (üì§) i din webbl√§sare" data-da="Tryk p√• Del-knappen (üì§) i din browser" data-fi="Napauta Jaa-painiketta (üì§) selaimessasi">Tap the Share button (üì§) in your browser</li>
                <li data-en="Select 'Add to Home Screen'" data-ja="„Äå„Éõ„Éº„É†ÁîªÈù¢„Å´ËøΩÂä†„Äç„ÇíÈÅ∏Êäû" data-zh="ÈÄâÊã©"Ê∑ªÂä†Âà∞‰∏ªÂ±èÂπï"" data-ko="'Ìôà ÌôîÎ©¥Ïóê Ï∂îÍ∞Ä'Î•º ÏÑ†ÌÉùÌïòÏÑ∏Ïöî" data-es="Selecciona 'A√±adir a pantalla de inicio'" data-fr="S√©lectionnez 'Ajouter √† l'√©cran d'accueil'" data-de="W√§hlen Sie 'Zum Startbildschirm hinzuf√ºgen'" data-it="Seleziona 'Aggiungi alla schermata Home'" data-pt="Selecione 'Adicionar √† tela inicial'" data-ru="–í—ã–±–µ—Ä–∏—Ç–µ '–î–æ–±–∞–≤–∏—Ç—å –Ω–∞ –≥–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω'" data-ar="ÿßÿÆÿ™ÿ± 'ÿ•ÿ∂ÿßŸÅÿ© ÿ•ŸÑŸâ ÿßŸÑÿ¥ÿßÿ¥ÿ© ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©'" data-hi="'‡§π‡•ã‡§Æ ‡§∏‡•ç‡§ï‡•ç‡§∞‡•Ä‡§® ‡§Æ‡•á‡§Ç ‡§ú‡•ã‡§°‡§º‡•á‡§Ç' ‡§ö‡•Å‡§®‡•á‡§Ç" data-tr="'Ana Ekrana Ekle'yi se√ßin" data-vi="Ch·ªçn 'Th√™m v√†o m√†n h√¨nh ch√≠nh'" data-th="‡πÄ‡∏•‡∏∑‡∏≠‡∏Å '‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏´‡∏•‡∏±‡∏Å'" data-pl="Wybierz 'Dodaj do ekranu g≈Ç√≥wnego'" data-nl="Selecteer 'Voeg toe aan startscherm'" data-sv="V√§lj 'L√§gg till p√• hemsk√§rmen'" data-da="V√¶lg 'Tilf√∏j til startsk√¶rm'" data-fi="Valitse 'Lis√§√§ kotin√§ytt√∂√∂n'">Select 'Add to Home Screen'</li>
                <li data-en="Tap 'Add' to install" data-ja="„Ç§„É≥„Çπ„Éà„Éº„É´„Åô„Çã„Å´„ÅØ„ÄåËøΩÂä†„Äç„Çí„Çø„ÉÉ„Éó" data-zh="ÁÇπÂáª"Ê∑ªÂä†"ËøõË°åÂÆâË£Ö" data-ko="ÏÑ§ÏπòÌïòÎ†§Î©¥ 'Ï∂îÍ∞Ä'Î•º ÌÉ≠ÌïòÏÑ∏Ïöî" data-es="Toca 'A√±adir' para instalar" data-fr="Appuyez sur 'Ajouter' pour installer" data-de="Tippen Sie auf 'Hinzuf√ºgen' zum Installieren" data-it="Tocca 'Aggiungi' per installare" data-pt="Toque em 'Adicionar' para instalar" data-ru="–ù–∞–∂–º–∏—Ç–µ '–î–æ–±–∞–≤–∏—Ç—å' –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏" data-ar="ÿßŸÜŸÇÿ± ÿπŸÑŸâ 'ÿ•ÿ∂ÿßŸÅÿ©' ŸÑŸÑÿ™ÿ´ÿ®Ÿäÿ™" data-hi="‡§á‡§Ç‡§∏‡•ç‡§ü‡•â‡§≤ ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è '‡§ú‡•ã‡§°‡§º‡•á‡§Ç' ‡§ü‡•à‡§™ ‡§ï‡§∞‡•á‡§Ç" data-tr="Y√ºklemek i√ßin 'Ekle'ye dokunun" data-vi="Nh·∫•n 'Th√™m' ƒë·ªÉ c√†i ƒë·∫∑t" data-th="‡πÅ‡∏ï‡∏∞ '‡πÄ‡∏û‡∏¥‡πà‡∏°' ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á" data-pl="Dotknij 'Dodaj', aby zainstalowaƒá" data-nl="Tik op 'Toevoegen' om te installeren" data-sv="Tryck p√• 'L√§gg till' f√∂r att installera" data-da="Tryk p√• 'Tilf√∏j' for at installere" data-fi="Napauta 'Lis√§√§' asentaaksesi">Tap 'Add' to install</li>
                <li data-en="The PinYin icon will appear on your home screen!" data-ja="„Éî„É≥„Ç§„É≥„Ç¢„Ç§„Ç≥„É≥„Åå„Éõ„Éº„É†ÁîªÈù¢„Å´Ë°®Á§∫„Åï„Çå„Åæ„ÅôÔºÅ" data-zh="ÊãºÈü≥ÂõæÊ†áÂ∞ÜÂá∫Áé∞Âú®ÊÇ®ÁöÑ‰∏ªÂ±èÂπï‰∏äÔºÅ" data-ko="PinYin ÏïÑÏù¥ÏΩòÏù¥ Ìôà ÌôîÎ©¥Ïóê ÎÇòÌÉÄÎÇ† Í≤ÉÏûÖÎãàÎã§!" data-es="¬°El icono de PinYin aparecer√° en tu pantalla de inicio!" data-fr="L'ic√¥ne PinYin appara√Ætra sur votre √©cran d'accueil !" data-de="Das PinYin-Symbol erscheint auf Ihrem Startbildschirm!" data-it="L'icona PinYin apparir√† sulla schermata Home!" data-pt="O √≠cone PinYin aparecer√° na sua tela inicial!" data-ru="–ó–Ω–∞—á–æ–∫ –ü–∏–Ω—å–∏–Ω—å –ø–æ—è–≤–∏—Ç—Å—è –Ω–∞ –≥–ª–∞–≤–Ω–æ–º —ç–∫—Ä–∞–Ω–µ!" data-ar="ÿ≥ÿ™ÿ∏Ÿáÿ± ÿ£ŸäŸÇŸàŸÜÿ© ÿ®ŸäŸÜŸäŸäŸÜ ÿπŸÑŸâ ÿ¥ÿßÿ¥ÿ™ŸÉ ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©!" data-hi="PinYin ‡§Ü‡§á‡§ï‡§® ‡§Ü‡§™‡§ï‡•Ä ‡§π‡•ã‡§Æ ‡§∏‡•ç‡§ï‡•ç‡§∞‡•Ä‡§® ‡§™‡§∞ ‡§¶‡§ø‡§ñ‡§æ‡§à ‡§¶‡•á‡§ó‡§æ!" data-tr="PinYin simgesi ana ekranƒ±nƒ±zda g√∂r√ºnecek!" data-vi="Bi·ªÉu t∆∞·ª£ng PinYin s·∫Ω xu·∫•t hi·ªán tr√™n m√†n h√¨nh ch√≠nh c·ªßa b·∫°n!" data-th="‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡∏û‡∏¥‡∏ô‡∏≠‡∏¥‡∏ô‡∏à‡∏∞‡∏õ‡∏£‡∏≤‡∏Å‡∏è‡∏ö‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏´‡∏•‡∏±‡∏Å‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì!" data-pl="Ikona PinYin pojawi siƒô na ekranie g≈Ç√≥wnym!" data-nl="Het PinYin-pictogram verschijnt op je startscherm!" data-sv="PinYin-ikonen kommer att visas p√• din hemsk√§rm!" data-da="PinYin-ikonet vil vises p√• din startsk√¶rm!" data-fi="PinYin-ikoni n√§kyy kotin√§yt√∂ll√§si!">The PinYin icon will appear on your home screen!</li>
            </ol>
        </div>
    </div>

    <script>
(function() {
  var supported = ['en','ja','zh','ko','es','fr','de','it','pt','ru','ar','hi','tr','vi'];
  var path = window.location.pathname.replace(/^\//, '').replace(/\/$/, '');
  if (path && !supported.includes(path)) {
    var style = '<style>body{background:#fff;color:#111;margin:0;padding:0;font-family:sans-serif;text-align:center;display:flex;flex-direction:column;justify-content:center;align-items:center;height:100vh;}@media (prefers-color-scheme:dark){body{background:#111;color:#fff;}}</style>';
    document.body.innerHTML = style + '<div><h1 style="font-size:2.5em;margin-bottom:0.5em;">404 Not Found</h1><div style="font-size:1.2em;">The requested URL was not found on this server.</div></div>';
    document.title = '404 Not Found';
    history.replaceState(null, '', '/404');
    throw new Error('404');
  }
})();
        // Pinyin mapping data
        const pinyinMap = {};
        let currentLanguage = 'en';
        
        // Supported languages mapping
        const supportedLanguages = {
            'en': 'en', 'en-US': 'en', 'en-GB': 'en',
            'ja': 'ja', 'ja-JP': 'ja',
            'zh': 'zh', 'zh-CN': 'zh', 'zh-TW': 'zh', 'zh-HK': 'zh',
            'ko': 'ko', 'ko-KR': 'ko',
            'es': 'es', 'es-ES': 'es', 'es-MX': 'es',
            'fr': 'fr', 'fr-FR': 'fr', 'fr-CA': 'fr',
            'de': 'de', 'de-DE': 'de', 'de-AT': 'de', 'de-CH': 'de',
            'it': 'it', 'it-IT': 'it',
            'pt': 'pt', 'pt-PT': 'pt', 'pt-BR': 'pt',
            'ru': 'ru', 'ru-RU': 'ru',
            'ar': 'ar', 'ar-SA': 'ar', 'ar-EG': 'ar',
            'hi': 'hi', 'hi-IN': 'hi',
            'tr': 'tr', 'tr-TR': 'tr',
            'vi': 'vi', 'vi-VN': 'vi',
            'th': 'th', 'th-TH': 'th',
            'pl': 'pl', 'pl-PL': 'pl',
            'nl': 'nl', 'nl-NL': 'nl', 'nl-BE': 'nl',
            'sv': 'sv', 'sv-SE': 'sv',
            'da': 'da', 'da-DK': 'da',
            'fi': 'fi', 'fi-FI': 'fi'
        };
        
        // Detect language from URL path (e.g. /ja, /fr)
        function detectLangFromPath() {
            const path = window.location.pathname.split('/').filter(Boolean);
            if (path.length > 0 && supportedLanguages[path[0]]) {
                return supportedLanguages[path[0]];
            }
            return null;
        }

        // Detect browser language
        function detectLangFromBrowser() {
            const browserLang = navigator.language || navigator.userLanguage || 'en';
            if (supportedLanguages[browserLang]) {
                return supportedLanguages[browserLang];
            }
            const langCode = browserLang.split('-')[0];
            for (const [fullCode, supportedCode] of Object.entries(supportedLanguages)) {
                if (fullCode.startsWith(langCode + '-') || fullCode === langCode) {
                    return supportedCode;
                }
            }
            return 'en';
        }

        // Load translations from locales/xx.json
        async function loadTranslations(lang) {
            try {
                const res = await fetch(`/locales/${lang}.json`);
                if (!res.ok) throw new Error('not found');
                return await res.json();
            } catch {
                // fallback to English
                if (lang !== 'en') return loadTranslations('en');
                return {};
            }
        }

        // Apply translations to UI
        function applyTranslations(translations) {
            // Apply translations from JSON file
            if (translations.app_title) {
                document.querySelector('.app-title').textContent = translations.app_title;
                document.title = translations.app_title;
            }
            if (translations.subtitle) {
                document.querySelector('.subtitle').textContent = translations.subtitle;
            }
            if (translations.input_label) {
                document.querySelector('label[for="chineseInput"]').textContent = translations.input_label;
            }
            if (translations.placeholder) {
                document.querySelector('#chineseInput').placeholder = translations.placeholder;
            }
            if (translations.tone_format) {
                document.querySelector('label[data-en="Tone format:"]').textContent = translations.tone_format;
            }
            if (translations.tonal_signs) {
                document.querySelector('span[data-en="Tonal signs (ƒÅ, √°, «é, √†)"]').textContent = translations.tonal_signs;
            }
            if (translations.tonal_numbers) {
                document.querySelector('span[data-en="Tonal numbers (a1, a2, a3, a4)"]').textContent = translations.tonal_numbers;
            }
            if (translations.convert_btn) {
                document.querySelector('.convert-btn').textContent = translations.convert_btn;
            }
            if (translations.clear_btn) {
                document.querySelector('.clear-btn').textContent = translations.clear_btn;
            }
            if (translations.placeholder) {
                document.querySelector('#chineseInput').placeholder = translations.placeholder;
            }
            if (translations.result_label) {
                document.querySelector('#result').textContent = translations.result_label;
            }
            if (translations.app_description) {
                document.querySelector('p[data-en="This is a Progressive Web App that works like a native app!"]').textContent = translations.app_description;
            }
            if (translations.install_title) {
                document.querySelector('h4[data-en="üì≤ Install as Native App:"]').textContent = translations.install_title;
            }
            if (translations.install_step1) {
                document.querySelector('li[data-en="Tap the Share button (üì§) in your browser"]').textContent = translations.install_step1;
            }
            if (translations.install_step2) {
                document.querySelector('li[data-en="Select \'Add to Home Screen\'"]').textContent = translations.install_step2;
            }
            if (translations.install_step3) {
                document.querySelector('li[data-en="Tap \'Add\' to install"]').textContent = translations.install_step3;
            }
            if (translations.install_step4) {
                document.querySelector('li[data-en="The PinYin icon will appear on your home screen!"]').textContent = translations.install_step4;
            }
            
            // Apply translations from data-* attributes
            const elementsWithData = document.querySelectorAll('[data-' + currentLanguage + ']');
            elementsWithData.forEach(element => {
                const translation = element.getAttribute('data-' + currentLanguage);
                if (translation) {
                    // For textarea elements, set placeholder instead of textContent
                    if (element.tagName === 'TEXTAREA') {
                        element.placeholder = translation;
                        element.textContent = ''; // Clear any existing text content
                    } else {
                        element.textContent = translation;
                    }
                }
            });
        }

        // Ë®ÄË™ûÊ±∫ÂÆö„Å®UIÂèçÊò†
        async function setUILanguage() {
            let lang = detectLangFromPath() || detectLangFromBrowser();
            currentLanguage = lang;
            const translations = await loadTranslations(lang);
            applyTranslations(translations);
        }
        
        // Load pinyin data
        async function loadPinyinData() {
            try {
                const response = await fetch('/pinyin_map.json');
                const data = await response.json();
                Object.assign(pinyinMap, data);
            } catch (error) {
                console.error('Error loading pinyin data:', error);
            }
        }
        
        // Convert Chinese to Pinyin with details
        function convertToPinyinWithDetails(input) {
            let result = '';
            let detailText = '';
            
            console.log('convertToPinyinWithDetails input:', input);
            
            // Helper function to add spaces to multi-character pinyin
            function addSpacesToMultiCharPinyin(pinyin, word) {
                // Special handling for common multi-character words with tone marks
                switch (word) {
                    // Â•Ω - h«éoÔºà3Â£∞Ôºâ„Å® h√†oÔºà4Â£∞Ôºâ
                    case 'Â•ΩÂ•áÂøÉ': return 'h√†o q√≠ xƒ´n';
                    case 'Â•ΩÂ≠¶': return 'h√†o xu√©';
                    case 'Áà±Â•Ω': return '√†i h√†o';
                    case 'ÂñúÂ•Ω': return 'x«ê h√†o';
                    case 'ÂèãÂ•Ω': return 'y«íu h«éo';
                    case 'ËâØÂ•Ω': return 'li√°ng h«éo';
                    
                    // Ë°å - x√≠ngÔºà2Â£∞Ôºâ„Å® h√°ngÔºà2Â£∞Ôºâ
                    case 'Èì∂Ë°å': return 'y√≠n h√°ng';
                    case 'Ë°å‰∏ö': return 'h√°ng y√®';
                    case 'Èì∂Ë°åÂÆ∂': return 'y√≠n h√°ng jiƒÅ';
                    case 'Ë°å‰∏∫': return 'x√≠ng w√©i';
                    case 'Ë°åÂä®': return 'x√≠ng d√≤ng';
                    case 'Ë°åËµ∞': return 'x√≠ng z«íu';
                    
                    // Èáç - zh√≤ngÔºà4Â£∞Ôºâ„Å® ch√≥ngÔºà2Â£∞Ôºâ
                    case 'ÈáçÂ∫Ü': return 'ch√≥ng q√¨ng';
                    case 'ÈáçÂ§ç': return 'ch√≥ng f√π';
                    case 'ÈáçÊñ∞': return 'ch√≥ng xƒ´n';
                    case 'ÈáçË¶Å': return 'zh√≤ng y√†o';
                    case 'ÈáçÈáè': return 'zh√≤ng li√†ng';
                    case 'ÈáçËßÜ': return 'zh√≤ng sh√¨';
                    
                    // Èïø - ch√°ngÔºà2Â£∞Ôºâ„Å® zh«éngÔºà3Â£∞Ôºâ
                    case 'ÈïøÂ∫¶': return 'ch√°ng d√π';
                    case 'ÈïøÊúü': return 'ch√°ng qƒ´';
                    case 'Èïø‰πÖ': return 'ch√°ng ji«î';
                    case 'ÊàêÈïø': return 'ch√©ng zh«éng';
                    case 'Â¢ûÈïø': return 'zƒìng zh«éng';
                    case 'Ê†°Èïø': return 'xi√†o zh«éng';
                    
                    // Âèë - fƒÅÔºà1Â£∞Ôºâ„Å® f√†Ôºà4Â£∞Ôºâ
                    case 'ÂèëÂ±ï': return 'fƒÅ zh«én';
                    case 'ÂèëÁé∞': return 'fƒÅ xi√†n';
                    case 'ÂèëÁîü': return 'fƒÅ shƒìng';
                    case 'Â§¥Âèë': return 't√≥u fa';
                    case 'ÁêÜÂèë': return 'l«ê f√†';
                    
                    // Âæó - d√©Ôºà2Â£∞Ôºâ„ÄÅdeÔºàËªΩÂ£∞Ôºâ„ÄÅdƒõiÔºà3Â£∞Ôºâ
                    case 'ÂæóÂà∞': return 'd√© d√†o';
                    case 'Ëé∑Âæó': return 'hu√≤ d√©';
                    case 'ËßâÂæó': return 'ju√© de';
                    case 'ËÆ∞Âæó': return 'j√¨ de';
                    case 'ÈùûÂæó': return 'fƒìi dƒõi';
                    case 'ÊÄªÂæó': return 'z«íng dƒõi';
                    
                    // ÁùÄ - zheÔºàËªΩÂ£∞Ôºâ„ÄÅzh√°oÔºà2Â£∞Ôºâ„ÄÅzhu√≥Ôºà2Â£∞Ôºâ
                    case 'ÁúãÁùÄ': return 'k√†n zhe';
                    case 'Âê¨ÁùÄ': return 'tƒ´ng zhe';
                    case 'Áù°ÁùÄ': return 'shu√¨ zh√°o';
                    case 'ÁùÄÊÄ•': return 'zh√°o j√≠';
                    case 'Á©øÁùÄ': return 'chuƒÅn zhu√≥';
                    case 'ÁùÄÊâã': return 'zhu√≥ sh«íu';
                    
                    // ‰∫Ü - leÔºàËªΩÂ£∞Ôºâ„Å® li«éoÔºà3Â£∞Ôºâ
                    case 'ÂÆå‰∫Ü': return 'w√°n le';
                    case 'Ëµ∞‰∫Ü': return 'z«íu le';
                    case '‰∫ÜËß£': return 'li«éo jiƒõ';
                    case '‰∫ÜÁªì': return 'li«éo ji√©';
                    
                    // ‰∏ç - b√πÔºà4Â£∞Ôºâ„Å® b√∫Ôºà2Â£∞Ôºâ
                    case '‰∏çÂØπ': return 'b√∫ du√¨';
                    case '‰∏çÈîô': return 'b√∫ cu√≤';
                    case '‰∏çË¶Å': return 'b√∫ y√†o';
                    case '‰∏çÊòØ': return 'b√∫ sh√¨';
                    case '‰∏çËÉΩ': return 'b√π n√©ng';
                    case '‰∏ç‰ºö': return 'b√π hu√¨';
                    
                    // ‰∏Ä - yƒ´Ôºà1Â£∞Ôºâ„ÄÅy√≠Ôºà2Â£∞Ôºâ„ÄÅy√¨Ôºà4Â£∞Ôºâ
                    case '‰∏ÄÂ§©': return 'y√¨ tiƒÅn';
                    case '‰∏ÄÂπ¥': return 'y√¨ ni√°n';
                    case '‰∏Ä‰∏™': return 'y√≠ g√®';
                    case '‰∏Ä‰∫õ': return 'y√¨ xiƒì';
                    case 'Á¨¨‰∏Ä': return 'd√¨ yƒ´';
                    case 'ÂîØ‰∏Ä': return 'w√©i yƒ´';
                    
                    // Â§ß - d√†Ôºà4Â£∞Ôºâ„Å® d√†iÔºà4Â£∞Ôºâ
                    case 'Â§ßÂ≠¶': return 'd√† xu√©';
                    case 'Â§ßÂÆ∂': return 'd√† jiƒÅ';
                    case 'Â§ßÂ§´': return 'd√†i fu';
                    
                    // Â∞è - xi«éoÔºà3Â£∞Ôºâ„Å® xi√†oÔºà4Â£∞Ôºâ
                    case 'Â∞èÂ≠©': return 'xi«éo h√°i';
                    case 'Â∞èÂ≠¶': return 'xi«éo xu√©';
                    case 'Â≠ùÂ≠ê': return 'xi√†o z«ê';
                    
                    // ‰∏≠ - zh≈çngÔºà1Â£∞Ôºâ„Å® zh√≤ngÔºà4Â£∞Ôºâ
                    case '‰∏≠ÂõΩ': return 'zh≈çng gu√≥';
                    case '‰∏≠Èó¥': return 'zh≈çng jiƒÅn';
                    case '‰∏≠Â•ñ': return 'zh√≤ng ji«éng';
                    case '‰∏≠ÊØí': return 'zh√≤ng d√∫';
                    
                    // Âåó - bƒõiÔºà3Â£∞Ôºâ
                    case 'Âåó‰∫¨': return 'bƒõi jƒ´ng';
                    case 'ÂåóÊñπ': return 'bƒõi fƒÅng';
                    case '‰∏úÂåó': return 'd≈çng bƒõi';
                    case 'Ë•øÂåó': return 'xƒ´ bƒõi';
                    
                    // ‰∏∫ - w√©iÔºà2Â£∞Ôºâ„Å® w√®iÔºà4Â£∞Ôºâ
                    case '‰∏∫‰∫Ü': return 'w√®i le';
                    case 'Âõ†‰∏∫': return 'yƒ´n w√®i';
                    case '‰Ωú‰∏∫': return 'zu√≤ w√©i';
                    case 'Êàê‰∏∫': return 'ch√©ng w√©i';
                    
                    // Âíå - h√©Ôºà2Â£∞Ôºâ„ÄÅh√®Ôºà4Â£∞Ôºâ„ÄÅhu√≥Ôºà2Â£∞Ôºâ„ÄÅhu√≤Ôºà4Â£∞Ôºâ
                    case 'ÂíåÂπ≥': return 'h√© p√≠ng';
                    case 'ÂíåË∞ê': return 'h√© xi√©';
                    case 'ÈôÑÂíå': return 'f√π h√®';
                    case 'ÂíåÈù¢': return 'hu√≥ mi√†n';
                    case 'ÂíåËçØ': return 'hu√≤ y√†o';
                    
                    // Ëøò - h√°iÔºà2Â£∞Ôºâ„Å® hu√°nÔºà2Â£∞Ôºâ
                    case 'ËøòÊòØ': return 'h√°i sh√¨';
                    case 'ËøòÊúâ': return 'h√°i y«íu';
                    case 'ÂΩíËøò': return 'guƒ´ hu√°n';
                    case 'ËøòÈí±': return 'hu√°n qi√°n';
                    
                    // ÈÉΩ - d≈çuÔºà1Â£∞Ôºâ„Å® d≈´Ôºà1Â£∞Ôºâ
                    case 'ÈÉΩÊòØ': return 'd≈çu sh√¨';
                    case 'ÈÉΩÊúâ': return 'd≈çu y«íu';
                    case 'È¶ñÈÉΩ': return 'sh«íu d≈´';
                    case 'ÈÉΩÂ∏Ç': return 'd≈´ sh√¨';
                    
                    // Âú∞ - d√¨Ôºà4Â£∞Ôºâ„Å® deÔºàËªΩÂ£∞Ôºâ
                    case 'Âú∞Êñπ': return 'd√¨ fƒÅng';
                    case 'Âú∞Âå∫': return 'd√¨ q≈´';
                    case 'ÊÖ¢ÊÖ¢Âú∞': return 'm√†n m√†n de';
                    case 'Â•ΩÂ•ΩÂú∞': return 'h«éo h«éo de';
                    
                    // ÁöÑ - deÔºàËªΩÂ£∞Ôºâ„ÄÅd√≠Ôºà2Â£∞Ôºâ„ÄÅd√¨Ôºà4Â£∞Ôºâ
                    case 'ÊàëÁöÑ': return 'w«í de';
                    case '‰Ω†ÁöÑ': return 'n«ê de';
                    case 'ÁöÑÁ°Æ': return 'd√≠ qu√®';
                    case 'ÁõÆÁöÑ': return 'm√π d√¨';
                    case 'Ê†áÁöÑ': return 'biƒÅo d√¨';
                    
                    // Ëøá - gu√≤Ôºà4Â£∞Ôºâ„Å® guoÔºàËªΩÂ£∞Ôºâ
                    case 'ËøáÂéª': return 'gu√≤ q√π';
                    case 'ÁªèËøá': return 'jƒ´ng gu√≤';
                    case 'ÂéªËøá': return 'q√π guo';
                    case 'ÁúãËøá': return 'k√†n guo';
                    
                    // Êù• - l√°iÔºà2Â£∞Ôºâ„Å® laiÔºàËªΩÂ£∞Ôºâ
                    case 'Êù•Âà∞': return 'l√°i d√†o';
                    case 'ÂõûÊù•': return 'hu√≠ lai';
                    case 'Âá∫Êù•': return 'ch≈´ lai';
                    
                    // Âéª - q√πÔºà4Â£∞Ôºâ„Å® quÔºàËªΩÂ£∞Ôºâ
                    case 'ÂéªÂπ¥': return 'q√π ni√°n';
                    case 'ÂõûÂéª': return 'hu√≠ qu';
                    case 'Âá∫Âéª': return 'ch≈´ qu';
                    
                    // ‰∏ä - sh√†ngÔºà4Â£∞Ôºâ„Å® shangÔºàËªΩÂ£∞Ôºâ
                    case '‰∏äÈù¢': return 'sh√†ng mi√†n';
                    case 'Êó©‰∏ä': return 'z«éo shang';
                    case 'Êôö‰∏ä': return 'w«én shang';
                    
                    // ‰∏ã - xi√†Ôºà4Â£∞Ôºâ„Å® xiaÔºàËªΩÂ£∞Ôºâ
                    case '‰∏ãÈù¢': return 'xi√† mi√†n';
                    case 'Âú∞‰∏ã': return 'd√¨ xia';
                    case '‰π°‰∏ã': return 'xiƒÅng xia';
                    
                    // Èáå - l«êÔºà3Â£∞Ôºâ„Å® liÔºàËªΩÂ£∞Ôºâ
                    case 'ÈáåÈù¢': return 'l«ê mi√†n';
                    case 'ËøôÈáå': return 'zh√® li';
                    case 'ÈÇ£Èáå': return 'n√† li';
                    
                    // Â§ñ - w√†iÔºà4Â£∞Ôºâ„Å® waiÔºàËªΩÂ£∞Ôºâ
                    case 'Â§ñÈù¢': return 'w√†i mi√†n';
                    case 'ÂõΩÂ§ñ': return 'gu√≥ wai';
                    case 'Êµ∑Â§ñ': return 'h«éi wai';
                    
                    // Ââç - qi√°nÔºà2Â£∞Ôºâ„Å® qianÔºàËªΩÂ£∞Ôºâ
                    case 'ÂâçÈù¢': return 'qi√°n mi√†n';
                    case '‰ª•Ââç': return 'y«ê qian';
                    case '‰ªéÂâç': return 'c√≥ng qian';
                    
                    // Âêé - h√≤uÔºà4Â£∞Ôºâ„Å® houÔºàËªΩÂ£∞Ôºâ
                    case 'ÂêéÈù¢': return 'h√≤u mi√†n';
                    case '‰ª•Âêé': return 'y«ê hou';
                    
                    // ÂÜÖ - n√®iÔºà4Â£∞Ôºâ„Å® neiÔºàËªΩÂ£∞Ôºâ
                    case 'ÂÜÖÈÉ®': return 'n√®i b√π';
                    case 'ÂõΩÂÜÖ': return 'gu√≥ nei';
                    case 'Â∏ÇÂÜÖ': return 'sh√¨ nei';
                    
                    // Èó¥ - jiƒÅnÔºà1Â£∞Ôºâ„Å® jianÔºàËªΩÂ£∞Ôºâ
                    case 'Êó∂Èó¥': return 'sh√≠ jiƒÅn';
                    case 'ÊàøÈó¥': return 'f√°ng jian';
                    
                    // ÈÉΩÂ∏ÇÂêç
                    case 'ËãèÂ∑û': return 's≈´ zh≈çu';
                    case 'Êó†Èî°': return 'w√∫ xƒ´';
                    case 'ÂÆÅÊ≥¢': return 'n√≠ng b≈ç';
                    case 'Ê∏©Â∑û': return 'wƒìn zh≈çu';
                    case '‰ΩõÂ±±': return 'f√≥ shƒÅn';
                    case '‰∏úËéû': return 'd≈çng gu«én';
                    case '‰∏≠Â±±': return 'zh≈çng shƒÅn';
                    case 'Áè†Êµ∑': return 'zh≈´ h«éi';
                    case 'ÊÉ†Â∑û': return 'hu√¨ zh≈çu';
                    case 'Ê±üÈó®': return 'jiƒÅng m√©n';
                    case 'ËÇáÂ∫Ü': return 'zh√†o q√¨ng';
                    case 'Ê∏ÖËøú': return 'qƒ´ng yu«én';
                    case 'Èü∂ÂÖ≥': return 'sh√°o guƒÅn';
                    case 'ÊπõÊ±ü': return 'zh√†n jiƒÅng';
                    case 'ËåÇÂêç': return 'm√†o m√≠ng';
                    case 'Èò≥Ê±ü': return 'y√°ng jiƒÅng';
                    case '‰∫ëÊµÆ': return 'y√∫n f√∫';
                    case 'ÊΩÆÂ∑û': return 'ch√°o zh≈çu';
                    case 'Êè≠Èò≥': return 'jiƒì y√°ng';
                    case 'Ê±ïÂ∞æ': return 'sh√†n wƒõi';
                    case 'Ê≤≥Ê∫ê': return 'h√© yu√°n';
                    case 'Ê¢ÖÂ∑û': return 'm√©i zh≈çu';
                    case 'Ê±ïÂ§¥': return 'sh√†n t√≥u';
                    
                    // Âü∫Êú¨ÁöÑÊå®Êã∂„ÉªË°®Áèæ
                    case '‰Ω†Â•Ω': return 'n«ê h«éo';
                    case 'Ë∞¢Ë∞¢': return 'xi√® xie';
                    case 'ÂÜçËßÅ': return 'z√†i ji√†n';
                    case 'ÂØπ‰∏çËµ∑': return 'du√¨ bu q«ê';
                    case 'Ê≤°ÂÖ≥Á≥ª': return 'm√©i guƒÅn xi';
                    case '‰∏çÂÆ¢Ê∞î': return 'b√∫ k√® qi';
                    
                    default:
                        // For other multi-character words, try to split by tone marks
                        const toneVowel = 'ƒÅ√°«é√†ƒì√©ƒõ√®ƒ´√≠«ê√¨≈ç√≥«í√≤≈´√∫«î√π«ñ«ò«ö«ú';
                        const syllableRegex = new RegExp(`[bpmfdtnlgkhjqxrzcsywzhchsh]?[a-z√º√ú]+[${toneVowel}](ng|n)?`, 'gi');
                        const syllables = pinyin.match(syllableRegex) || [];
                        if (syllables.length > 1) {
                            return syllables.join(' ');
                        } else {
                            return pinyin;
                        }
                }
            }
            
            // First, try to match multi-character words
            let i = 0;
            while (i < input.length) {
                let matched = false;
                
                // Try to match multi-character words (up to 4 characters)
                for (let len = 4; len >= 1; len--) {
                    if (i + len <= input.length) {
                        const word = input.substring(i, i + len);
                        console.log(`Checking word "${word}" at position ${i}, length ${len}`);
                        if (pinyinMap[word]) {
                            const readings = pinyinMap[word];
                            console.log(`Found multi-char word "${word}":`, readings);
                            if (Array.isArray(readings)) {
                                console.log(`Multi-char word "${word}":`, readings);
                                // For multi-character words, use the combined pinyin but add spaces between characters
                                const pinyin = readings[0];
                                // Use the helper function to get properly spaced pinyin
                                const spacedPinyin = addSpacesToMultiCharPinyin(pinyin, word);
                                result += spacedPinyin + ' ';
                                if (readings.length > 1) {
                                    detailText += `${word}: ${readings.join(', ')} `;
                                }
                            } else {
                                const pinyin = readings;
                                // Use the helper function to get properly spaced pinyin
                                const spacedPinyin = addSpacesToMultiCharPinyin(pinyin, word);
                                result += spacedPinyin + ' ';
                            }
                            i += len;
                            matched = true;
                            break;
                        }
                    }
                }
                
                // If no multi-character word found, try single character
                if (!matched) {
                    const char = input[i];
                    console.log(`No multi-char match, trying single char "${char}"`);
                    if (pinyinMap[char]) {
                        const readings = pinyinMap[char];
                        if (Array.isArray(readings)) {
                            console.log(`Single char "${char}":`, readings);
                            result += readings[0] + ' ';
                            if (readings.length > 1) {
                                detailText += `${char}: ${readings.join(', ')} `;
                            }
                        } else {
                            result += readings + ' ';
                        }
                    } else if (char.match(/[\u4e00-\u9fff]/)) {
                        result += char + ' ';
                    } else {
                        result += char;
                    }
                    i++;
                }
            }
            
            console.log('Final result:', result);
            console.log('Final detailText:', detailText);
            return { result: result.trim(), detailText: detailText.trim() };
        }
        
        // Convert Chinese to Pinyin
        function convertToPinyin() {
            const input = document.getElementById('chineseInput').value.trim();
            const resultDiv = document.getElementById('result');
            const detailsDiv = document.getElementById('details');
            const toneType = document.querySelector('input[name="toneType"]:checked').value;
            
            if (!input) {
                const noInputText = document.querySelector('#result').getAttribute('data-' + currentLanguage) || 'Please enter some Chinese text...';
                resultDiv.textContent = noInputText;
                detailsDiv.style.display = 'none';
                return;
            }
            
            const loadingText = document.querySelector('#result').getAttribute('data-' + currentLanguage) || 'Converting...';
            resultDiv.innerHTML = '<div class="loading">' + loadingText + '</div>';
            detailsDiv.style.display = 'none';
            
            setTimeout(() => {
                const { result, detailText } = convertToPinyinWithDetails(input);
                
                // Apply tone number conversion if needed
                let finalResult = result;
                        if (toneType === 'number') {
                    finalResult = convertPinyinToNumber(result);
                        }
                
                // Apply tone number conversion to detail text if needed
                let finalDetailText = detailText;
                if (toneType === 'number' && detailText) {
                    console.log('Converting detail text to numbers:', detailText);
                    // For detail text, we need to convert each reading individually
                    // because the format is "char: reading1, reading2"
                    finalDetailText = convertDetailTextToNumber(detailText);
                    console.log('Converted detail text:', finalDetailText);
                }
                
                const noChineseText = document.querySelector('#result').getAttribute('data-' + currentLanguage) || 'No Chinese characters found.';
                resultDiv.textContent = finalResult || noChineseText;
                
                if (finalDetailText) {
                    detailsDiv.textContent = finalDetailText;
                    detailsDiv.style.display = 'block';
                } else {
                    detailsDiv.style.display = 'none';
                }
            }, 100);
        }
        // Convert pinyin with tone marks to tone numbers
        function convertPinyinToNumber(pinyin) {
            console.log('convertPinyinToNumber input:', pinyin);
            
            const toneMap = {
                'ƒÅ': ['a', '1'], '√°': ['a', '2'], '«é': ['a', '3'], '√†': ['a', '4'],
                'ƒì': ['e', '1'], '√©': ['e', '2'], 'ƒõ': ['e', '3'], '√®': ['e', '4'],
                'ƒ´': ['i', '1'], '√≠': ['i', '2'], '«ê': ['i', '3'], '√¨': ['i', '4'],
                '≈ç': ['o', '1'], '√≥': ['o', '2'], '«í': ['o', '3'], '√≤': ['o', '4'],
                '≈´': ['u', '1'], '√∫': ['u', '2'], '«î': ['u', '3'], '√π': ['u', '4'],
                '«ñ': ['v', '1'], '«ò': ['v', '2'], '«ö': ['v', '3'], '«ú': ['v', '4']
            };
            
            // If pinyin contains spaces, split by spaces first
            if (pinyin.includes(" ")) {
                const syllables = pinyin.split(" ");
                const result = syllables.map(syllable => {
                    return convertSingleSyllable(syllable, toneMap);
                }).join(" ");
                console.log('convertPinyinToNumber result (space-split):', result);
                return result;
            }
            
            const toneVowel = "ƒÅ√°«é√†ƒì√©ƒõ√®ƒ´√≠«ê√¨≈ç√≥«í√≤≈´√∫«î√π«ñ«ò«ö«úaeiou√º";
            // Only split for multi-syllable words (length > 4 and no spaces/hyphens)
            const needsSplit = pinyin.length > 4 && !pinyin.includes(" ") && !pinyin.includes("-");
            
            console.log('needsSplit:', needsSplit, 'pinyin length:', pinyin.length);
            
            let syllables;
            if (needsSplit) {
                const syllableRegex = new RegExp(`[bpmfdtnlgkhjqxrzcsywzhchsh]?[a-z√º√ú]+[${toneVowel}](ng|n)?`, 'gi');
                const found = pinyin.match(syllableRegex) || [];
                syllables = found.length > 0 ? found : [pinyin];
                console.log('Split syllables:', syllables);
            } else {
                syllables = [pinyin];
                console.log('Single syllable:', syllables);
            }
            
            const result = syllables.map(syllable => {
                return convertSingleSyllable(syllable, toneMap);
            }).join(" ");
            
            console.log('convertPinyinToNumber result:', result);
            return result;
        }
        
        // Convert a single syllable from tone marks to tone numbers
        function convertSingleSyllable(syllable, toneMap) {
            let converted = syllable;
            let toneNumber = '';
            
            for (const [toneChar, [base, num]] of Object.entries(toneMap)) {
                if (converted.includes(toneChar)) {
                    converted = converted.replace(toneChar, base);
                    toneNumber = num;
                    break;
                }
            }
            
            const final = toneNumber ? converted + toneNumber : converted;
            console.log(`Syllable "${syllable}" -> "${final}"`);
            return final;
        }
        
        // Convert detail text format "char: reading1, reading2" to tone numbers
        function convertDetailTextToNumber(detailText) {
            console.log('convertDetailTextToNumber input:', detailText);
            const toneMap = {
                'ƒÅ': ['a', '1'], '√°': ['a', '2'], '«é': ['a', '3'], '√†': ['a', '4'],
                'ƒì': ['e', '1'], '√©': ['e', '2'], 'ƒõ': ['e', '3'], '√®': ['e', '4'],
                'ƒ´': ['i', '1'], '√≠': ['i', '2'], '«ê': ['i', '3'], '√¨': ['i', '4'],
                '≈ç': ['o', '1'], '√≥': ['o', '2'], '«í': ['o', '3'], '√≤': ['o', '4'],
                '≈´': ['u', '1'], '√∫': ['u', '2'], '«î': ['u', '3'], '√π': ['u', '4'],
                '«ñ': ['v', '1'], '«ò': ['v', '2'], '«ö': ['v', '3'], '«ú': ['v', '4']
            };
            
            // Handle the format "char: reading1, reading2"
            // First, find the colon and split
            const colonIndex = detailText.indexOf(': ');
            if (colonIndex !== -1) {
                const char = detailText.substring(0, colonIndex);
                const readingsPart = detailText.substring(colonIndex + 2).trim();
                console.log('Processing char:', char, 'readings part:', readingsPart);
                
                const readingList = readingsPart.split(', ');
                console.log('Reading list:', readingList);
                
                const convertedReadings = readingList.map(reading => {
                    const converted = convertSingleSyllable(reading.trim(), toneMap);
                    console.log('Converted reading:', reading, '->', converted);
                    return converted;
                });
                
                const result = `${char}: ${convertedReadings.join(', ')}`;
                console.log('convertDetailTextToNumber final result:', result);
                return result;
            }
            
            // Fallback: return as is
            return detailText;
        }
        
        // Clear all inputs and results
        function clearAll() {
            document.getElementById('chineseInput').value = '';
            const resultDiv = document.getElementById('result');
            const detailsDiv = document.getElementById('details');
            const placeholderText = resultDiv.getAttribute('data-' + currentLanguage) || 'Pinyin will appear here...';
            resultDiv.textContent = placeholderText;
            detailsDiv.style.display = 'none';
        }
        
        // Handle Enter key in textarea
        document.getElementById('chineseInput').addEventListener('keydown', function(e) {
            if (e.key === 'Enter' && e.ctrlKey) {
                convertToPinyin();
            }
        });
        
        // Initialize app
        async function initApp() {
            await setUILanguage();
            await loadPinyinData();
        }
        
        // Initialize when page loads
        initApp();
        
        // Service Worker registration for PWA
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/sw.js')
                .then(function(registration) {
                    console.log('ServiceWorker registration successful');
                })
                .catch(function(err) {
                    console.log('ServiceWorker registration failed');
                });
        }
    </script>
</body>
</html>