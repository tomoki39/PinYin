<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>PinYin</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" sizes="32x32" href="/icons/pinyin_icon_32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/icons/pinyin_icon_16x16.png">
    <link rel="apple-touch-icon" href="/icons/pinyin_icon_192x192.png">
    
    <!-- iOS Web App Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="拼音">
    
    <!-- iOS Icons -->
    <link rel="apple-touch-icon" href="/icons/pinyin_icon_192x192.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/icons/pinyin_icon_144x144.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/icons/pinyin_icon_192x192.png">
    <link rel="apple-touch-icon" sizes="167x167" href="/icons/pinyin_icon_144x144.png">
    
    <!-- Web App Manifest -->
    <link rel="manifest" href="/manifest.json">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #ffffff;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            /* iOS-specific styles */
            padding-top: env(safe-area-inset-top);
            padding-bottom: env(safe-area-inset-bottom);
        }
        
        .container {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 500px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .app-title {
            font-size: 2.5em;
            font-weight: 700;
            color: #DC143C;
            margin-bottom: 10px;
        }
        
        .subtitle {
            color: #666;
            font-size: 1.1em;
        }
        
        .input-section {
            margin-bottom: 25px;
        }
        
        .input-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }
        
        input, textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid #e1e5e9;
            border-radius: 12px;
            font-size: 16px;
            transition: border-color 0.3s ease;
            font-family: inherit;
        }
        
        input:focus, textarea:focus {
            outline: none;
            border-color: #DC143C;
        }
        
        input::placeholder, textarea::placeholder {
            color: #999;
            opacity: 1;
        }
        
        textarea {
            resize: vertical;
            min-height: 120px;
        }
        
        .button-group {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
        }
        
        button {
            flex: 1;
            padding: 15px 20px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: inherit;
        }
        
        .convert-btn {
            background: linear-gradient(45deg, #DC143C, #B22222);
            color: white;
        }
        
        .convert-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(220, 20, 60, 0.3);
        }
        
        .clear-btn {
            background: #f5f5f5;
            color: #666;
        }
        
        .clear-btn:hover {
            background: #e0e0e0;
        }
        
        .result-section {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            min-height: 100px;
        }
        
        .result-text {
            font-size: 18px;
            line-height: 1.6;
            color: #333;
            word-wrap: break-word;
        }
        
        .loading {
            text-align: center;
            color: #666;
            font-style: italic;
        }
        
        .instructions {
            margin-top: 20px;
            padding: 15px;
            background: #fff5f5;
            border-radius: 10px;
            border-left: 4px solid #DC143C;
        }
        
        .instructions h3 {
            color: #DC143C;
            margin-bottom: 10px;
        }
        
        .instructions p {
            color: #555;
            font-size: 14px;
            line-height: 1.5;
        }
        
        .install-instructions {
            margin-top: 15px;
            padding: 10px;
            background: #fff3cd;
            border-radius: 8px;
            border-left: 4px solid #ffc107;
        }
        
        .install-instructions h4 {
            color: #856404;
            margin-bottom: 8px;
            font-size: 14px;
        }
        
        .install-instructions ol {
            color: #856404;
            font-size: 12px;
        }
        
        /* Responsive design for tone options */
        @media (max-width: 600px) {
            .tone-options {
                flex-direction: column !important;
                gap: 8px !important;
            }
            
            .tone-options label {
                min-width: 0 !important;
                flex: none !important;
            }
        }
        
        /* Custom radio button styling */
        input[type="radio"] {
            margin: 0;
            padding: 0;
            width: 16px;
            height: 16px;
            cursor: pointer;
        }
        
        .install-instructions ol {
            padding-left: 20px;
        }
        
        .install-instructions li {
            margin-bottom: 4px;
        }
        
        /* Dark mode support */
        @media (prefers-color-scheme: dark) {
            body {
                background: #1a1a1a;
            }
            
            .container {
                background: #2c3e50;
                color: white;
            }
            
            .app-title {
                color: #DC143C;
            }
            
            .subtitle {
                color: #bdc3c7;
            }
            
            label {
                color: #ecf0f1;
            }
            
            input, textarea {
                background: #34495e;
                border-color: #7f8c8d;
                color: white;
            }
            
            input:focus, textarea:focus {
                border-color: #DC143C;
            }
            
            .result-section {
                background: #34495e;
            }
            
            .result-text {
                color: #ecf0f1;
            }
            
            .instructions {
                background: #2c3e50;
                border-left-color: #DC143C;
            }
            
            .instructions h3 {
                color: #DC143C;
            }
            
            .instructions p {
                color: #bdc3c7;
            }
            
            .install-instructions {
                background: #34495e;
                border-left-color: #f39c12;
            }
            
            .install-instructions h4 {
                color: #f39c12;
            }
            
            .install-instructions ol {
                color: #f39c12;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 class="app-title" data-en="PinYin" data-ja="ピンイン" data-zh="拼音" data-ko="병음" data-es="PinYin" data-fr="PinYin" data-de="PinYin" data-it="PinYin" data-pt="PinYin" data-ru="Пиньинь" data-ar="بينيين" data-hi="पिनयिन" data-tr="PinYin" data-vi="PinYin" data-th="พินอิน" data-pl="PinYin" data-nl="PinYin" data-sv="PinYin" data-da="PinYin" data-fi="PinYin">PinYin</h1>
            <p class="subtitle" data-en="Chinese to Pinyin Converter" data-ja="中国語からピンインへの変換" data-zh="中文转拼音工具" data-ko="중국어 병음 변환기" data-es="Convertidor de Chino a Pinyin" data-fr="Convertisseur Chinois vers Pinyin" data-de="Chinesisch zu Pinyin Konverter" data-it="Convertitore Cinese-Pinyin" data-pt="Conversor Chinês-Pinyin" data-ru="Конвертер китайского в пиньинь" data-ar="محول الصينية إلى بينيين" data-hi="चीनी से पिनयिन कनवर्टर" data-tr="Çince-Pinyin Dönüştürücü" data-vi="Bộ chuyển đổi tiếng Trung sang Pinyin" data-th="ตัวแปลงภาษาจีนเป็นพินอิน" data-pl="Konwerter chińskiego na Pinyin" data-nl="Chinees naar Pinyin converter" data-sv="Kinesisk till Pinyin konverterare" data-da="Kinesisk til Pinyin konverter" data-fi="Kiinan-Pinyin muunnin">Chinese to Pinyin Converter</p>
        </div>
        
        <div class="input-section">
            <div class="input-group">
                <label for="chineseInput" data-en="Chinese Text:" data-ja="中国語テキスト:" data-zh="中文文本:" data-ko="중국어 텍스트:" data-es="Texto Chino:" data-fr="Texte Chinois:" data-de="Chinesischer Text:" data-it="Testo Cinese:" data-pt="Texto Chinês:" data-ru="Китайский текст:" data-ar="النص الصيني:" data-hi="चीनी पाठ:" data-tr="Çince Metin:" data-vi="Văn bản tiếng Trung:" data-th="ข้อความจีน:" data-pl="Tekst chiński:" data-nl="Chinese tekst:" data-sv="Kinesisk text:" data-da="Kinesisk tekst:" data-fi="Kiinan teksti:">Chinese Text:</label>
                <textarea id="chineseInput" data-en="Enter Chinese characters here..." data-ja="ここに中国語文字を入力してください..." data-zh="在此输入中文字符..." data-ko="여기에 중국어 문자를 입력하세요..." data-es="Ingrese caracteres chinos aquí..." data-fr="Entrez des caractères chinois ici..." data-de="Geben Sie hier chinesische Zeichen ein..." data-it="Inserisci caratteri cinesi qui..." data-pt="Digite caracteres chineses aqui..." data-ru="Введите китайские символы здесь..." data-ar="أدخل الأحرف الصينية هنا..." data-hi="यहां चीनी अक्षर दर्ज करें..." data-tr="Buraya Çince karakterler girin..." data-vi="Nhập ký tự tiếng Trung tại đây..." data-th="ป้อนอักขระจีนที่นี่..." data-pl="Wprowadź znaki chińskie tutaj..." data-nl="Voer hier Chinese karakters in..." data-sv="Ange kinesiska tecken här..." data-da="Indtast kinesiske tegn her..." data-fi="Syötä kiinalaisia merkkejä tähän..." placeholder="Enter Chinese characters here..."></textarea>
            </div>
            <!-- 声調表記切り替えラジオボタン追加 -->
            <div class="input-group" style="margin-bottom: 10px;">
                <label data-en="Tone format:" data-ja="声調形式：" data-zh="声调格式：" data-ko="성조 형식:" data-es="Formato de tono:" data-fr="Format de ton:" data-de="Tonformat:" data-it="Formato tonale:" data-pt="Formato de tom:" data-ru="Формат тона:" data-ar="تنسيق النغمة:" data-hi="स्वर प्रारूप:" data-tr="Ton formatı:" data-vi="Định dạng thanh điệu:" data-th="รูปแบบเสียง:" data-pl="Format tonu:" data-nl="Toonformaat:" data-sv="Tonformat:" data-da="Toneformat:" data-fi="Sävelmuoto:">Tone format:</label>
                <div class="tone-options" style="display: flex; gap: 16px; margin-top: 4px; flex-wrap: wrap; justify-content: flex-start;">
                    <label style="display: flex; align-items: center; gap: 2px; min-width: 0; flex: 0 1 auto; margin: 0; padding: 0;"><input type="radio" name="toneType" value="sign" checked> <span data-en="Tonal signs (ā, á, ǎ, à)" data-ja="声調符号 (ā, á, ǎ, à)" data-zh="声调符号 (ā, á, ǎ, à)" data-ko="성조 기호 (ā, á, ǎ, à)" data-es="Signos tonales (ā, á, ǎ, à)" data-fr="Signes tonaux (ā, á, ǎ, à)" data-de="Tonzeichen (ā, á, ǎ, à)" data-it="Segni tonali (ā, á, ǎ, à)" data-pt="Sinais tonais (ā, á, ǎ, à)" data-ru="Тональные знаки (ā, á, ǎ, à)" data-ar="علامات النغمة (ā, á, ǎ, à)" data-hi="स्वर चिह्न (ā, á, ǎ, à)" data-tr="Ton işaretleri (ā, á, ǎ, à)" data-vi="Dấu thanh điệu (ā, á, ǎ, à)" data-th="เครื่องหมายเสียง (ā, á, ǎ, à)" data-pl="Znaki tonalne (ā, á, ǎ, à)" data-nl="Toontekens (ā, á, ǎ, à)" data-sv="Tonala tecken (ā, á, ǎ, à)" data-da="Tonale tegn (ā, á, ǎ, à)" data-fi="Sävelmerkit (ā, á, ǎ, à)">Tonal signs (ā, á, ǎ, à)</span></label>
                    <label style="display: flex; align-items: center; gap: 2px; min-width: 0; flex: 0 1 auto; margin: 0; padding: 0;"><input type="radio" name="toneType" value="number"> <span data-en="Tonal numbers (a1, a2, a3, a4)" data-ja="声調数字 (a1, a2, a3, a4)" data-zh="声调数字 (a1, a2, a3, a4)" data-ko="성조 숫자 (a1, a2, a3, a4)" data-es="Números tonales (a1, a2, a3, a4)" data-fr="Nombres tonaux (a1, a2, a3, a4)" data-de="Tonzahlen (a1, a2, a3, a4)" data-it="Numeri tonali (a1, a2, a3, a4)" data-pt="Números tonais (a1, a2, a3, a4)" data-ru="Тональные числа (a1, a2, a3, a4)" data-ar="أرقام النغمة (a1, a2, a3, a4)" data-hi="स्वर संख्याएं (a1, a2, a3, a4)" data-tr="Ton numaraları (a1, a2, a3, a4)" data-vi="Số thanh điệu (a1, a2, a3, a4)" data-th="ตัวเลขเสียง (a1, a2, a3, a4)" data-pl="Liczby tonalne (a1, a2, a3, a4)" data-nl="Toonnummers (a1, a2, a3, a4)" data-sv="Tonala siffror (a1, a2, a3, a4)" data-da="Tonale tal (a1, a2, a3, a4)" data-fi="Sävelnumerot (a1, a2, a3, a4)">Tonal numbers (a1, a2, a3, a4)</span></label>
                </div>
            </div>
            
            <div class="button-group">
                <button class="convert-btn" onclick="convertToPinyin()" data-en="Convert to Pinyin" data-ja="ピンインに変換" data-zh="转换为拼音" data-ko="병음으로 변환" data-es="Convertir a Pinyin" data-fr="Convertir en Pinyin" data-de="Zu Pinyin konvertieren" data-it="Converti in Pinyin" data-pt="Converter para Pinyin" data-ru="Конвертировать в пиньинь" data-ar="تحويل إلى بينيين" data-hi="पिनयिन में बदलें" data-tr="Pinyin'e Dönüştür" data-vi="Chuyển đổi sang Pinyin" data-th="แปลงเป็นพินอิน" data-pl="Konwertuj na Pinyin" data-nl="Converteren naar Pinyin" data-sv="Konvertera till Pinyin" data-da="Konverter til Pinyin" data-fi="Muunna Pinyiniksi">Convert to Pinyin</button>
                <button class="clear-btn" onclick="clearAll()" data-en="Clear" data-ja="クリア" data-zh="清除" data-ko="지우기" data-es="Limpiar" data-fr="Effacer" data-de="Löschen" data-it="Cancella" data-pt="Limpar" data-ru="Очистить" data-ar="مسح" data-hi="साफ़ करें" data-tr="Temizle" data-vi="Xóa" data-th="ล้าง" data-pl="Wyczyść" data-nl="Wissen" data-sv="Rensa" data-da="Ryd" data-fi="Tyhjennä">Clear</button>
            </div>
        </div>
        
        <div class="result-section">
            <div id="result" class="result-text" data-en="Pinyin will appear here..." data-ja="ピンインがここに表示されます..." data-zh="拼音将在此显示..." data-ko="병음이 여기에 나타날 것입니다..." data-es="El Pinyin aparecerá aquí..." data-fr="Le Pinyin apparaîtra ici..." data-de="Pinyin wird hier erscheinen..." data-it="Il Pinyin apparirà qui..." data-pt="O Pinyin aparecerá aqui..." data-ru="Пиньинь появится здесь..." data-ar="سيظهر البينيين هنا..." data-hi="पिनयिन यहां दिखाई देगा..." data-tr="Pinyin burada görünecek..." data-vi="Pinyin sẽ xuất hiện ở đây..." data-th="พินอินจะปรากฏที่นี่..." data-pl="Pinyin pojawi się tutaj..." data-nl="Pinyin verschijnt hier..." data-sv="Pinyin kommer att visas här..." data-da="Pinyin vil vises her..." data-fi="Pinyin näkyy täällä...">Pinyin will appear here...</div>
            <div id="details" style="display: none; margin-top: 10px; padding: 10px; background-color: #f8f9fa; border-left: 3px solid #007bff; font-size: 0.9em; color: #666;"></div>
        </div>
        
        <div class="instructions">
            <h3 data-en="📱 PinYin App" data-ja="📱 ピンインアプリ" data-zh="📱 拼音应用" data-ko="📱 병음 앱" data-es="📱 Aplicación PinYin" data-fr="📱 Application PinYin" data-de="📱 PinYin App" data-it="📱 App PinYin" data-pt="📱 Aplicativo PinYin" data-ru="📱 Приложение Пиньинь" data-ar="📱 تطبيق بينيين" data-hi="📱 पिनयिन ऐप" data-tr="📱 PinYin Uygulaması" data-vi="📱 Ứng dụng PinYin" data-th="📱 แอปพินอิน" data-pl="📱 Aplikacja PinYin" data-nl="📱 PinYin App" data-sv="📱 PinYin App" data-da="📱 PinYin App" data-fi="📱 PinYin-sovellus">📱 PinYin App</h3>
            <p data-en="This is a Progressive Web App that works like a native app!" data-ja="これはネイティブアプリのように動作するプログレッシブウェブアプリです！" data-zh="这是一个像原生应用一样工作的渐进式网络应用！" data-ko="네이티브 앱처럼 작동하는 프로그레시브 웹 앱입니다!" data-es="¡Esta es una aplicación web progresiva que funciona como una aplicación nativa!" data-fr="C'est une application web progressive qui fonctionne comme une application native !" data-de="Dies ist eine Progressive Web App, die wie eine native App funktioniert!" data-it="Questa è un'app web progressiva che funziona come un'app nativa!" data-pt="Esta é um aplicativo web progressivo que funciona como um aplicativo nativo!" data-ru="Это прогрессивное веб-приложение, которое работает как нативное приложение!" data-ar="هذا تطبيق ويب تدريجي يعمل مثل التطبيق الأصلي!" data-hi="यह एक प्रोग्रेसिव वेब ऐप है जो नेटिव ऐप की तरह काम करता है!" data-tr="Bu, yerel uygulama gibi çalışan bir ilerleyici web uygulamasıdır!" data-vi="Đây là ứng dụng web tiến bộ hoạt động như ứng dụng gốc!" data-th="นี่คือแอปพลิเคชันเว็บแบบก้าวหน้าที่ทำงานเหมือนแอปเนทีฟ!" data-pl="To jest progresywna aplikacja internetowa, która działa jak natywna aplikacja!" data-nl="Dit is een progressieve web-app die werkt als een native app!" data-sv="Detta är en progressiv webbapp som fungerar som en inbyggd app!" data-da="Dette er en progressiv web-app der fungerer som en native app!" data-fi="Tämä on progressiivinen verkkosovellus, joka toimii kuin natiivisovellus!">This is a Progressive Web App that works like a native app!</p>
        </div>
        
        <div class="install-instructions">
            <h4 data-en="📲 Install as Native App:" data-ja="📲 ネイティブアプリとしてインストール:" data-zh="📲 作为原生应用安装:" data-ko="📲 네이티브 앱으로 설치:" data-es="📲 Instalar como aplicación nativa:" data-fr="📲 Installer como application native:" data-de="📲 Als native App installieren:" data-it="📲 Installa come app nativa:" data-pt="📲 Instalar como aplicativo nativo:" data-ru="📲 Установить как нативное приложение:" data-ar="📲 تثبيت كتطبيق أصلي:" data-hi="📲 नेटिव ऐप के रूप में इंस्टॉल करें:" data-tr="📲 Yerel Uygulama Olarak Yükle:" data-vi="📲 Cài đặt như ứng dụng gốc:" data-th="📲 ติดตั้งเป็นแอปเนทีฟ:" data-pl="📲 Zainstaluj jako aplikację natywną:" data-nl="📲 Installeren als native app:" data-sv="📲 Installera som inbyggd app:" data-da="📲 Installer som native app:" data-fi="📲 Asenna natiivisovelluksena:">📲 Install as Native App:</h4>
            <ol>
                <li data-en="Tap the Share button (📤) in your browser" data-ja="ブラウザで共有ボタン（📤）をタップ" data-zh="在浏览器中点击分享按钮（📤）" data-ko="브라우저에서 공유 버튼(📤)을 탭하세요" data-es="Toca el botón Compartir (📤) en tu navegador" data-fr="Appuyez sur le bouton Partager (📤) dans votre navigateur" data-de="Tippen Sie auf die Teilen-Schaltfläche (📤) in Ihrem Browser" data-it="Tocca il pulsante Condividi (📤) nel tuo browser" data-pt="Toque no botão Compartilhar (📤) no seu navegador" data-ru="Нажмите кнопку Поделиться (📤) в вашем браузере" data-ar="انقر على زر المشاركة (📤) في متصفحك" data-hi="अपने ब्राउज़र में शेयर बटन (📤) टैप करें" data-tr="Tarayıcınızda Paylaş düğmesine (📤) dokunun" data-vi="Nhấn nút Chia sẻ (📤) trong trình duyệt của bạn" data-th="แตะปุ่มแชร์ (📤) ในเบราว์เซอร์ของคุณ" data-pl="Dotknij przycisku Udostępnij (📤) w swojej przeglądarce" data-nl="Tik op de Deel-knop (📤) in je browser" data-sv="Tryck på Dela-knappen (📤) i din webbläsare" data-da="Tryk på Del-knappen (📤) i din browser" data-fi="Napauta Jaa-painiketta (📤) selaimessasi">Tap the Share button (📤) in your browser</li>
                <li data-en="Select 'Add to Home Screen'" data-ja="「ホーム画面に追加」を選択" data-zh="选择"添加到主屏幕"" data-ko="'홈 화면에 추가'를 선택하세요" data-es="Selecciona 'Añadir a pantalla de inicio'" data-fr="Sélectionnez 'Ajouter à l'écran d'accueil'" data-de="Wählen Sie 'Zum Startbildschirm hinzufügen'" data-it="Seleziona 'Aggiungi alla schermata Home'" data-pt="Selecione 'Adicionar à tela inicial'" data-ru="Выберите 'Добавить на главный экран'" data-ar="اختر 'إضافة إلى الشاشة الرئيسية'" data-hi="'होम स्क्रीन में जोड़ें' चुनें" data-tr="'Ana Ekrana Ekle'yi seçin" data-vi="Chọn 'Thêm vào màn hình chính'" data-th="เลือก 'เพิ่มในหน้าจอหลัก'" data-pl="Wybierz 'Dodaj do ekranu głównego'" data-nl="Selecteer 'Voeg toe aan startscherm'" data-sv="Välj 'Lägg till på hemskärmen'" data-da="Vælg 'Tilføj til startskærm'" data-fi="Valitse 'Lisää kotinäyttöön'">Select 'Add to Home Screen'</li>
                <li data-en="Tap 'Add' to install" data-ja="インストールするには「追加」をタップ" data-zh="点击"添加"进行安装" data-ko="설치하려면 '추가'를 탭하세요" data-es="Toca 'Añadir' para instalar" data-fr="Appuyez sur 'Ajouter' pour installer" data-de="Tippen Sie auf 'Hinzufügen' zum Installieren" data-it="Tocca 'Aggiungi' per installare" data-pt="Toque em 'Adicionar' para instalar" data-ru="Нажмите 'Добавить' для установки" data-ar="انقر على 'إضافة' للتثبيت" data-hi="इंस्टॉल करने के लिए 'जोड़ें' टैप करें" data-tr="Yüklemek için 'Ekle'ye dokunun" data-vi="Nhấn 'Thêm' để cài đặt" data-th="แตะ 'เพิ่ม' เพื่อติดตั้ง" data-pl="Dotknij 'Dodaj', aby zainstalować" data-nl="Tik op 'Toevoegen' om te installeren" data-sv="Tryck på 'Lägg till' för att installera" data-da="Tryk på 'Tilføj' for at installere" data-fi="Napauta 'Lisää' asentaaksesi">Tap 'Add' to install</li>
                <li data-en="The PinYin icon will appear on your home screen!" data-ja="ピンインアイコンがホーム画面に表示されます！" data-zh="拼音图标将出现在您的主屏幕上！" data-ko="PinYin 아이콘이 홈 화면에 나타날 것입니다!" data-es="¡El icono de PinYin aparecerá en tu pantalla de inicio!" data-fr="L'icône PinYin apparaîtra sur votre écran d'accueil !" data-de="Das PinYin-Symbol erscheint auf Ihrem Startbildschirm!" data-it="L'icona PinYin apparirà sulla schermata Home!" data-pt="O ícone PinYin aparecerá na sua tela inicial!" data-ru="Значок Пиньинь появится на главном экране!" data-ar="ستظهر أيقونة بينيين على شاشتك الرئيسية!" data-hi="PinYin आइकन आपकी होम स्क्रीन पर दिखाई देगा!" data-tr="PinYin simgesi ana ekranınızda görünecek!" data-vi="Biểu tượng PinYin sẽ xuất hiện trên màn hình chính của bạn!" data-th="ไอคอนพินอินจะปรากฏบนหน้าจอหลักของคุณ!" data-pl="Ikona PinYin pojawi się na ekranie głównym!" data-nl="Het PinYin-pictogram verschijnt op je startscherm!" data-sv="PinYin-ikonen kommer att visas på din hemskärm!" data-da="PinYin-ikonet vil vises på din startskærm!" data-fi="PinYin-ikoni näkyy kotinäytölläsi!">The PinYin icon will appear on your home screen!</li>
            </ol>
        </div>
    </div>

    <script>
(function() {
  var supported = ['en','ja','zh','ko','es','fr','de','it','pt','ru','ar','hi','tr','vi'];
  var path = window.location.pathname.replace(/^\//, '').replace(/\/$/, '');
  if (path && !supported.includes(path)) {
    var style = '<style>body{background:#fff;color:#111;margin:0;padding:0;font-family:sans-serif;text-align:center;display:flex;flex-direction:column;justify-content:center;align-items:center;height:100vh;}@media (prefers-color-scheme:dark){body{background:#111;color:#fff;}}</style>';
    document.body.innerHTML = style + '<div><h1 style="font-size:2.5em;margin-bottom:0.5em;">404 Not Found</h1><div style="font-size:1.2em;">The requested URL was not found on this server.</div></div>';
    document.title = '404 Not Found';
    history.replaceState(null, '', '/404');
    throw new Error('404');
  }
})();
        // Pinyin mapping data
        const pinyinMap = {};
        let currentLanguage = 'en';
        
        // Supported languages mapping
        const supportedLanguages = {
            'en': 'en', 'en-US': 'en', 'en-GB': 'en',
            'ja': 'ja', 'ja-JP': 'ja',
            'zh': 'zh', 'zh-CN': 'zh', 'zh-TW': 'zh', 'zh-HK': 'zh',
            'ko': 'ko', 'ko-KR': 'ko',
            'es': 'es', 'es-ES': 'es', 'es-MX': 'es',
            'fr': 'fr', 'fr-FR': 'fr', 'fr-CA': 'fr',
            'de': 'de', 'de-DE': 'de', 'de-AT': 'de', 'de-CH': 'de',
            'it': 'it', 'it-IT': 'it',
            'pt': 'pt', 'pt-PT': 'pt', 'pt-BR': 'pt',
            'ru': 'ru', 'ru-RU': 'ru',
            'ar': 'ar', 'ar-SA': 'ar', 'ar-EG': 'ar',
            'hi': 'hi', 'hi-IN': 'hi',
            'tr': 'tr', 'tr-TR': 'tr',
            'vi': 'vi', 'vi-VN': 'vi',
            'th': 'th', 'th-TH': 'th',
            'pl': 'pl', 'pl-PL': 'pl',
            'nl': 'nl', 'nl-NL': 'nl', 'nl-BE': 'nl',
            'sv': 'sv', 'sv-SE': 'sv',
            'da': 'da', 'da-DK': 'da',
            'fi': 'fi', 'fi-FI': 'fi'
        };
        
        // Detect language from URL path (e.g. /ja, /fr)
        function detectLangFromPath() {
            const path = window.location.pathname.split('/').filter(Boolean);
            if (path.length > 0 && supportedLanguages[path[0]]) {
                return supportedLanguages[path[0]];
            }
            return null;
        }

        // Detect browser language
        function detectLangFromBrowser() {
            const browserLang = navigator.language || navigator.userLanguage || 'en';
            if (supportedLanguages[browserLang]) {
                return supportedLanguages[browserLang];
            }
            const langCode = browserLang.split('-')[0];
            for (const [fullCode, supportedCode] of Object.entries(supportedLanguages)) {
                if (fullCode.startsWith(langCode + '-') || fullCode === langCode) {
                    return supportedCode;
                }
            }
            return 'en';
        }

        // Load translations from locales/xx.json
        async function loadTranslations(lang) {
            try {
                const res = await fetch(`/locales/${lang}.json`);
                if (!res.ok) throw new Error('not found');
                return await res.json();
            } catch {
                // fallback to English
                if (lang !== 'en') return loadTranslations('en');
                return {};
            }
        }

        // Apply translations to UI
        function applyTranslations(translations) {
            // Apply translations from JSON file
            if (translations.app_title) {
                document.querySelector('.app-title').textContent = translations.app_title;
                document.title = translations.app_title;
            }
            if (translations.subtitle) {
                document.querySelector('.subtitle').textContent = translations.subtitle;
            }
            if (translations.input_label) {
                document.querySelector('label[for="chineseInput"]').textContent = translations.input_label;
            }
            if (translations.placeholder) {
                document.querySelector('#chineseInput').placeholder = translations.placeholder;
            }
            if (translations.tone_format) {
                document.querySelector('label[data-en="Tone format:"]').textContent = translations.tone_format;
            }
            if (translations.tonal_signs) {
                document.querySelector('span[data-en="Tonal signs (ā, á, ǎ, à)"]').textContent = translations.tonal_signs;
            }
            if (translations.tonal_numbers) {
                document.querySelector('span[data-en="Tonal numbers (a1, a2, a3, a4)"]').textContent = translations.tonal_numbers;
            }
            if (translations.convert_btn) {
                document.querySelector('.convert-btn').textContent = translations.convert_btn;
            }
            if (translations.clear_btn) {
                document.querySelector('.clear-btn').textContent = translations.clear_btn;
            }
            if (translations.placeholder) {
                document.querySelector('#chineseInput').placeholder = translations.placeholder;
            }
            if (translations.result_label) {
                document.querySelector('#result').textContent = translations.result_label;
            }
            if (translations.app_description) {
                document.querySelector('p[data-en="This is a Progressive Web App that works like a native app!"]').textContent = translations.app_description;
            }
            if (translations.install_title) {
                document.querySelector('h4[data-en="📲 Install as Native App:"]').textContent = translations.install_title;
            }
            if (translations.install_step1) {
                document.querySelector('li[data-en="Tap the Share button (📤) in your browser"]').textContent = translations.install_step1;
            }
            if (translations.install_step2) {
                document.querySelector('li[data-en="Select \'Add to Home Screen\'"]').textContent = translations.install_step2;
            }
            if (translations.install_step3) {
                document.querySelector('li[data-en="Tap \'Add\' to install"]').textContent = translations.install_step3;
            }
            if (translations.install_step4) {
                document.querySelector('li[data-en="The PinYin icon will appear on your home screen!"]').textContent = translations.install_step4;
            }
            
            // Apply translations from data-* attributes
            const elementsWithData = document.querySelectorAll('[data-' + currentLanguage + ']');
            elementsWithData.forEach(element => {
                const translation = element.getAttribute('data-' + currentLanguage);
                if (translation) {
                    // For textarea elements, set placeholder instead of textContent
                    if (element.tagName === 'TEXTAREA') {
                        element.placeholder = translation;
                        element.textContent = ''; // Clear any existing text content
                    } else {
                        element.textContent = translation;
                    }
                }
            });
        }

        // 言語決定とUI反映
        async function setUILanguage() {
            let lang = detectLangFromPath() || detectLangFromBrowser();
            currentLanguage = lang;
            const translations = await loadTranslations(lang);
            applyTranslations(translations);
        }
        
        // Load pinyin data
        async function loadPinyinData() {
            try {
                const response = await fetch('/pinyin_map.json');
                const data = await response.json();
                Object.assign(pinyinMap, data);
            } catch (error) {
                console.error('Error loading pinyin data:', error);
            }
        }
        
        // Convert Chinese to Pinyin with details
        function convertToPinyinWithDetails(input) {
            let result = '';
            let detailText = '';
            
            console.log('convertToPinyinWithDetails input:', input);
            
            // Helper function to add spaces to multi-character pinyin
            function addSpacesToMultiCharPinyin(pinyin, word) {
                // Special handling for common multi-character words with tone marks
                switch (word) {
                    // 好 - hǎo（3声）と hào（4声）
                    case '好奇心': return 'hào qí xīn';
                    case '好学': return 'hào xué';
                    case '爱好': return 'ài hào';
                    case '喜好': return 'xǐ hào';
                    case '友好': return 'yǒu hǎo';
                    case '良好': return 'liáng hǎo';
                    
                    // 行 - xíng（2声）と háng（2声）
                    case '银行': return 'yín háng';
                    case '行业': return 'háng yè';
                    case '银行家': return 'yín háng jiā';
                    case '行为': return 'xíng wéi';
                    case '行动': return 'xíng dòng';
                    case '行走': return 'xíng zǒu';
                    
                    // 重 - zhòng（4声）と chóng（2声）
                    case '重庆': return 'chóng qìng';
                    case '重复': return 'chóng fù';
                    case '重新': return 'chóng xīn';
                    case '重要': return 'zhòng yào';
                    case '重量': return 'zhòng liàng';
                    case '重视': return 'zhòng shì';
                    
                    // 长 - cháng（2声）と zhǎng（3声）
                    case '长度': return 'cháng dù';
                    case '长期': return 'cháng qī';
                    case '长久': return 'cháng jiǔ';
                    case '成长': return 'chéng zhǎng';
                    case '增长': return 'zēng zhǎng';
                    case '校长': return 'xiào zhǎng';
                    
                    // 发 - fā（1声）と fà（4声）
                    case '发展': return 'fā zhǎn';
                    case '发现': return 'fā xiàn';
                    case '发生': return 'fā shēng';
                    case '头发': return 'tóu fa';
                    case '理发': return 'lǐ fà';
                    
                    // 得 - dé（2声）、de（軽声）、děi（3声）
                    case '得到': return 'dé dào';
                    case '获得': return 'huò dé';
                    case '觉得': return 'jué de';
                    case '记得': return 'jì de';
                    case '非得': return 'fēi děi';
                    case '总得': return 'zǒng děi';
                    
                    // 着 - zhe（軽声）、zháo（2声）、zhuó（2声）
                    case '看着': return 'kàn zhe';
                    case '听着': return 'tīng zhe';
                    case '睡着': return 'shuì zháo';
                    case '着急': return 'zháo jí';
                    case '穿着': return 'chuān zhuó';
                    case '着手': return 'zhuó shǒu';
                    
                    // 了 - le（軽声）と liǎo（3声）
                    case '完了': return 'wán le';
                    case '走了': return 'zǒu le';
                    case '了解': return 'liǎo jiě';
                    case '了结': return 'liǎo jié';
                    
                    // 不 - bù（4声）と bú（2声）
                    case '不对': return 'bú duì';
                    case '不错': return 'bú cuò';
                    case '不要': return 'bú yào';
                    case '不是': return 'bú shì';
                    case '不能': return 'bù néng';
                    case '不会': return 'bù huì';
                    
                    // 一 - yī（1声）、yí（2声）、yì（4声）
                    case '一天': return 'yì tiān';
                    case '一年': return 'yì nián';
                    case '一个': return 'yí gè';
                    case '一些': return 'yì xiē';
                    case '第一': return 'dì yī';
                    case '唯一': return 'wéi yī';
                    
                    // 大 - dà（4声）と dài（4声）
                    case '大学': return 'dà xué';
                    case '大家': return 'dà jiā';
                    case '大夫': return 'dài fu';
                    
                    // 小 - xiǎo（3声）と xiào（4声）
                    case '小孩': return 'xiǎo hái';
                    case '小学': return 'xiǎo xué';
                    case '孝子': return 'xiào zǐ';
                    
                    // 中 - zhōng（1声）と zhòng（4声）
                    case '中国': return 'zhōng guó';
                    case '中间': return 'zhōng jiān';
                    case '中奖': return 'zhòng jiǎng';
                    case '中毒': return 'zhòng dú';
                    
                    // 北 - běi（3声）
                    case '北京': return 'běi jīng';
                    case '北方': return 'běi fāng';
                    case '东北': return 'dōng běi';
                    case '西北': return 'xī běi';
                    
                    // 为 - wéi（2声）と wèi（4声）
                    case '为了': return 'wèi le';
                    case '因为': return 'yīn wèi';
                    case '作为': return 'zuò wéi';
                    case '成为': return 'chéng wéi';
                    
                    // 和 - hé（2声）、hè（4声）、huó（2声）、huò（4声）
                    case '和平': return 'hé píng';
                    case '和谐': return 'hé xié';
                    case '附和': return 'fù hè';
                    case '和面': return 'huó miàn';
                    case '和药': return 'huò yào';
                    
                    // 还 - hái（2声）と huán（2声）
                    case '还是': return 'hái shì';
                    case '还有': return 'hái yǒu';
                    case '归还': return 'guī huán';
                    case '还钱': return 'huán qián';
                    
                    // 都 - dōu（1声）と dū（1声）
                    case '都是': return 'dōu shì';
                    case '都有': return 'dōu yǒu';
                    case '首都': return 'shǒu dū';
                    case '都市': return 'dū shì';
                    
                    // 地 - dì（4声）と de（軽声）
                    case '地方': return 'dì fāng';
                    case '地区': return 'dì qū';
                    case '慢慢地': return 'màn màn de';
                    case '好好地': return 'hǎo hǎo de';
                    
                    // 的 - de（軽声）、dí（2声）、dì（4声）
                    case '我的': return 'wǒ de';
                    case '你的': return 'nǐ de';
                    case '的确': return 'dí què';
                    case '目的': return 'mù dì';
                    case '标的': return 'biāo dì';
                    
                    // 过 - guò（4声）と guo（軽声）
                    case '过去': return 'guò qù';
                    case '经过': return 'jīng guò';
                    case '去过': return 'qù guo';
                    case '看过': return 'kàn guo';
                    
                    // 来 - lái（2声）と lai（軽声）
                    case '来到': return 'lái dào';
                    case '回来': return 'huí lai';
                    case '出来': return 'chū lai';
                    
                    // 去 - qù（4声）と qu（軽声）
                    case '去年': return 'qù nián';
                    case '回去': return 'huí qu';
                    case '出去': return 'chū qu';
                    
                    // 上 - shàng（4声）と shang（軽声）
                    case '上面': return 'shàng miàn';
                    case '早上': return 'zǎo shang';
                    case '晚上': return 'wǎn shang';
                    
                    // 下 - xià（4声）と xia（軽声）
                    case '下面': return 'xià miàn';
                    case '地下': return 'dì xia';
                    case '乡下': return 'xiāng xia';
                    
                    // 里 - lǐ（3声）と li（軽声）
                    case '里面': return 'lǐ miàn';
                    case '这里': return 'zhè li';
                    case '那里': return 'nà li';
                    
                    // 外 - wài（4声）と wai（軽声）
                    case '外面': return 'wài miàn';
                    case '国外': return 'guó wai';
                    case '海外': return 'hǎi wai';
                    
                    // 前 - qián（2声）と qian（軽声）
                    case '前面': return 'qián miàn';
                    case '以前': return 'yǐ qian';
                    case '从前': return 'cóng qian';
                    
                    // 后 - hòu（4声）と hou（軽声）
                    case '后面': return 'hòu miàn';
                    case '以后': return 'yǐ hou';
                    
                    // 内 - nèi（4声）と nei（軽声）
                    case '内部': return 'nèi bù';
                    case '国内': return 'guó nei';
                    case '市内': return 'shì nei';
                    
                    // 间 - jiān（1声）と jian（軽声）
                    case '时间': return 'shí jiān';
                    case '房间': return 'fáng jian';
                    
                    // 都市名
                    case '苏州': return 'sū zhōu';
                    case '无锡': return 'wú xī';
                    case '宁波': return 'níng bō';
                    case '温州': return 'wēn zhōu';
                    case '佛山': return 'fó shān';
                    case '东莞': return 'dōng guǎn';
                    case '中山': return 'zhōng shān';
                    case '珠海': return 'zhū hǎi';
                    case '惠州': return 'huì zhōu';
                    case '江门': return 'jiāng mén';
                    case '肇庆': return 'zhào qìng';
                    case '清远': return 'qīng yuǎn';
                    case '韶关': return 'sháo guān';
                    case '湛江': return 'zhàn jiāng';
                    case '茂名': return 'mào míng';
                    case '阳江': return 'yáng jiāng';
                    case '云浮': return 'yún fú';
                    case '潮州': return 'cháo zhōu';
                    case '揭阳': return 'jiē yáng';
                    case '汕尾': return 'shàn wěi';
                    case '河源': return 'hé yuán';
                    case '梅州': return 'méi zhōu';
                    case '汕头': return 'shàn tóu';
                    
                    // 基本的挨拶・表現
                    case '你好': return 'nǐ hǎo';
                    case '谢谢': return 'xiè xie';
                    case '再见': return 'zài jiàn';
                    case '对不起': return 'duì bu qǐ';
                    case '没关系': return 'méi guān xi';
                    case '不客气': return 'bú kè qi';
                    
                    default:
                        // For other multi-character words, try to split by tone marks
                        const toneVowel = 'āáǎàēéěèīíǐìōóǒòūúǔùǖǘǚǜ';
                        const syllableRegex = new RegExp(`[bpmfdtnlgkhjqxrzcsywzhchsh]?[a-züÜ]+[${toneVowel}](ng|n)?`, 'gi');
                        const syllables = pinyin.match(syllableRegex) || [];
                        if (syllables.length > 1) {
                            return syllables.join(' ');
                        } else {
                            return pinyin;
                        }
                }
            }
            
            // First, try to match multi-character words
            let i = 0;
            while (i < input.length) {
                let matched = false;
                
                // Try to match multi-character words (up to 4 characters)
                for (let len = 4; len >= 1; len--) {
                    if (i + len <= input.length) {
                        const word = input.substring(i, i + len);
                        console.log(`Checking word "${word}" at position ${i}, length ${len}`);
                        if (pinyinMap[word]) {
                            const readings = pinyinMap[word];
                            console.log(`Found multi-char word "${word}":`, readings);
                            if (Array.isArray(readings)) {
                                console.log(`Multi-char word "${word}":`, readings);
                                // For multi-character words, use the combined pinyin but add spaces between characters
                                const pinyin = readings[0];
                                // Use the helper function to get properly spaced pinyin
                                const spacedPinyin = addSpacesToMultiCharPinyin(pinyin, word);
                                result += spacedPinyin + ' ';
                                if (readings.length > 1) {
                                    detailText += `${word}: ${readings.join(', ')} `;
                                }
                            } else {
                                const pinyin = readings;
                                // Use the helper function to get properly spaced pinyin
                                const spacedPinyin = addSpacesToMultiCharPinyin(pinyin, word);
                                result += spacedPinyin + ' ';
                            }
                            i += len;
                            matched = true;
                            break;
                        }
                    }
                }
                
                // If no multi-character word found, try single character
                if (!matched) {
                    const char = input[i];
                    console.log(`No multi-char match, trying single char "${char}"`);
                    if (pinyinMap[char]) {
                        const readings = pinyinMap[char];
                        if (Array.isArray(readings)) {
                            console.log(`Single char "${char}":`, readings);
                            result += readings[0] + ' ';
                            if (readings.length > 1) {
                                detailText += `${char}: ${readings.join(', ')} `;
                            }
                        } else {
                            result += readings + ' ';
                        }
                    } else if (char.match(/[\u4e00-\u9fff]/)) {
                        result += char + ' ';
                    } else {
                        result += char;
                    }
                    i++;
                }
            }
            
            console.log('Final result:', result);
            console.log('Final detailText:', detailText);
            return { result: result.trim(), detailText: detailText.trim() };
        }
        
        // Convert Chinese to Pinyin
        function convertToPinyin() {
            const input = document.getElementById('chineseInput').value.trim();
            const resultDiv = document.getElementById('result');
            const detailsDiv = document.getElementById('details');
            const toneType = document.querySelector('input[name="toneType"]:checked').value;
            
            if (!input) {
                const noInputText = document.querySelector('#result').getAttribute('data-' + currentLanguage) || 'Please enter some Chinese text...';
                resultDiv.textContent = noInputText;
                detailsDiv.style.display = 'none';
                return;
            }
            
            const loadingText = document.querySelector('#result').getAttribute('data-' + currentLanguage) || 'Converting...';
            resultDiv.innerHTML = '<div class="loading">' + loadingText + '</div>';
            detailsDiv.style.display = 'none';
            
            setTimeout(() => {
                const { result, detailText } = convertToPinyinWithDetails(input);
                
                // Apply tone number conversion if needed
                let finalResult = result;
                        if (toneType === 'number') {
                    finalResult = convertPinyinToNumber(result);
                        }
                
                // Apply tone number conversion to detail text if needed
                let finalDetailText = detailText;
                if (toneType === 'number' && detailText) {
                    console.log('Converting detail text to numbers:', detailText);
                    // For detail text, we need to convert each reading individually
                    // because the format is "char: reading1, reading2"
                    finalDetailText = convertDetailTextToNumber(detailText);
                    console.log('Converted detail text:', finalDetailText);
                }
                
                const noChineseText = document.querySelector('#result').getAttribute('data-' + currentLanguage) || 'No Chinese characters found.';
                resultDiv.textContent = finalResult || noChineseText;
                
                if (finalDetailText) {
                    detailsDiv.textContent = finalDetailText;
                    detailsDiv.style.display = 'block';
                } else {
                    detailsDiv.style.display = 'none';
                }
            }, 100);
        }
        // Convert pinyin with tone marks to tone numbers
        function convertPinyinToNumber(pinyin) {
            console.log('convertPinyinToNumber input:', pinyin);
            
            const toneMap = {
                'ā': ['a', '1'], 'á': ['a', '2'], 'ǎ': ['a', '3'], 'à': ['a', '4'],
                'ē': ['e', '1'], 'é': ['e', '2'], 'ě': ['e', '3'], 'è': ['e', '4'],
                'ī': ['i', '1'], 'í': ['i', '2'], 'ǐ': ['i', '3'], 'ì': ['i', '4'],
                'ō': ['o', '1'], 'ó': ['o', '2'], 'ǒ': ['o', '3'], 'ò': ['o', '4'],
                'ū': ['u', '1'], 'ú': ['u', '2'], 'ǔ': ['u', '3'], 'ù': ['u', '4'],
                'ǖ': ['v', '1'], 'ǘ': ['v', '2'], 'ǚ': ['v', '3'], 'ǜ': ['v', '4']
            };
            
            // If pinyin contains spaces, split by spaces first
            if (pinyin.includes(" ")) {
                const syllables = pinyin.split(" ");
                const result = syllables.map(syllable => {
                    return convertSingleSyllable(syllable, toneMap);
                }).join(" ");
                console.log('convertPinyinToNumber result (space-split):', result);
                return result;
            }
            
            const toneVowel = "āáǎàēéěèīíǐìōóǒòūúǔùǖǘǚǜaeiouü";
            // Only split for multi-syllable words (length > 4 and no spaces/hyphens)
            const needsSplit = pinyin.length > 4 && !pinyin.includes(" ") && !pinyin.includes("-");
            
            console.log('needsSplit:', needsSplit, 'pinyin length:', pinyin.length);
            
            let syllables;
            if (needsSplit) {
                const syllableRegex = new RegExp(`[bpmfdtnlgkhjqxrzcsywzhchsh]?[a-züÜ]+[${toneVowel}](ng|n)?`, 'gi');
                const found = pinyin.match(syllableRegex) || [];
                syllables = found.length > 0 ? found : [pinyin];
                console.log('Split syllables:', syllables);
            } else {
                syllables = [pinyin];
                console.log('Single syllable:', syllables);
            }
            
            const result = syllables.map(syllable => {
                return convertSingleSyllable(syllable, toneMap);
            }).join(" ");
            
            console.log('convertPinyinToNumber result:', result);
            return result;
        }
        
        // Convert a single syllable from tone marks to tone numbers
        function convertSingleSyllable(syllable, toneMap) {
            let converted = syllable;
            let toneNumber = '';
            
            for (const [toneChar, [base, num]] of Object.entries(toneMap)) {
                if (converted.includes(toneChar)) {
                    converted = converted.replace(toneChar, base);
                    toneNumber = num;
                    break;
                }
            }
            
            const final = toneNumber ? converted + toneNumber : converted;
            console.log(`Syllable "${syllable}" -> "${final}"`);
            return final;
        }
        
        // Convert detail text format "char: reading1, reading2" to tone numbers
        function convertDetailTextToNumber(detailText) {
            console.log('convertDetailTextToNumber input:', detailText);
            const toneMap = {
                'ā': ['a', '1'], 'á': ['a', '2'], 'ǎ': ['a', '3'], 'à': ['a', '4'],
                'ē': ['e', '1'], 'é': ['e', '2'], 'ě': ['e', '3'], 'è': ['e', '4'],
                'ī': ['i', '1'], 'í': ['i', '2'], 'ǐ': ['i', '3'], 'ì': ['i', '4'],
                'ō': ['o', '1'], 'ó': ['o', '2'], 'ǒ': ['o', '3'], 'ò': ['o', '4'],
                'ū': ['u', '1'], 'ú': ['u', '2'], 'ǔ': ['u', '3'], 'ù': ['u', '4'],
                'ǖ': ['v', '1'], 'ǘ': ['v', '2'], 'ǚ': ['v', '3'], 'ǜ': ['v', '4']
            };
            
            // Handle the format "char: reading1, reading2"
            // First, find the colon and split
            const colonIndex = detailText.indexOf(': ');
            if (colonIndex !== -1) {
                const char = detailText.substring(0, colonIndex);
                const readingsPart = detailText.substring(colonIndex + 2).trim();
                console.log('Processing char:', char, 'readings part:', readingsPart);
                
                const readingList = readingsPart.split(', ');
                console.log('Reading list:', readingList);
                
                const convertedReadings = readingList.map(reading => {
                    const converted = convertSingleSyllable(reading.trim(), toneMap);
                    console.log('Converted reading:', reading, '->', converted);
                    return converted;
                });
                
                const result = `${char}: ${convertedReadings.join(', ')}`;
                console.log('convertDetailTextToNumber final result:', result);
                return result;
            }
            
            // Fallback: return as is
            return detailText;
        }
        
        // Clear all inputs and results
        function clearAll() {
            document.getElementById('chineseInput').value = '';
            const resultDiv = document.getElementById('result');
            const detailsDiv = document.getElementById('details');
            const placeholderText = resultDiv.getAttribute('data-' + currentLanguage) || 'Pinyin will appear here...';
            resultDiv.textContent = placeholderText;
            detailsDiv.style.display = 'none';
        }
        
        // Handle Enter key in textarea
        document.getElementById('chineseInput').addEventListener('keydown', function(e) {
            if (e.key === 'Enter' && e.ctrlKey) {
                convertToPinyin();
            }
        });
        
        // Initialize app
        async function initApp() {
            await setUILanguage();
            await loadPinyinData();
        }
        
        // Initialize when page loads
        initApp();
        
        // Service Worker registration for PWA
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/sw.js')
                .then(function(registration) {
                    console.log('ServiceWorker registration successful');
                })
                .catch(function(err) {
                    console.log('ServiceWorker registration failed');
                });
        }
    </script>
</body>
</html>